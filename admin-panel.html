<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberShield | Admin Panel</title>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cyber: {
                            dark: '#050b14',
                            blue: '#00f0ff',
                            purple: '#bd00ff',
                            red: '#ff003c',
                            glass: 'rgba(255, 255, 255, 0.05)'
                        }
                    },
                    animation: {
                        'spin-slow': 'spin 10s linear infinite',
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'scan': 'scan 4s linear infinite',
                        'fadeIn': 'fadeIn 0.5s ease-out',
                        'fadeOut': 'fadeOut 0.5s ease-out',
                        'slideUp': 'slideUp 0.4s ease-out',
                        'glow': 'glow 2s ease-in-out infinite',
                    },
                    keyframes: {
                        scan: {
                            '0%': { transform: 'translateY(-100%)' },
                            '100%': { transform: 'translateY(100%)' }
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        fadeOut: {
                            '0%': { opacity: '1' },
                            '100%': { opacity: '0' }
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        },
                        glow: {
                            '0%, 100%': { opacity: '1', filter: 'drop-shadow(0 0 10px rgba(0, 240, 255, 0.5))' },
                            '50%': { opacity: '0.8', filter: 'drop-shadow(0 0 20px rgba(0, 240, 255, 0.8))' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Outfit:wght@300;400;600;800&display=swap');

        body {
            background-color: #030712;
            color: #e2e8f0;
            font-family: 'Outfit', sans-serif;
            overflow-x: hidden;
        }

        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }

        /* Perspective Grid Background */
        .cyber-grid {
            position: fixed;
            width: 200%;
            height: 200%;
            top: -50%;
            left: -50%;
            background-image: 
                linear-gradient(transparent 0%, rgba(0, 240, 255, 0.05) 2%, transparent 3%),
                linear-gradient(90deg, transparent 0%, rgba(0, 240, 255, 0.05) 2%, transparent 3%);
            background-size: 50px 50px;
            transform: perspective(500px) rotateX(60deg);
            animation: grid-move 20s linear infinite;
            z-index: -1;
            pointer-events: none;
        }

        @keyframes grid-move {
            0% { transform: perspective(500px) rotateX(60deg) translateY(0); }
            100% { transform: perspective(500px) rotateX(60deg) translateY(50px); }
        }

        /* High-End Glassmorphism */
        .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }

        .glass-panel:hover {
            border-color: rgba(0, 240, 255, 0.3);
            box-shadow: 0 0 20px rgba(0, 240, 255, 0.1);
        }

        /* Neon Glow Text */
        .neon-text-blue {
            text-shadow: 0 0 10px rgba(0, 240, 255, 0.5);
        }
        .neon-text-red {
            text-shadow: 0 0 10px rgba(255, 0, 60, 0.5);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #0f172a;
        }
        ::-webkit-scrollbar-thumb {
            background: #1e293b;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #00f0ff;
        }

        /* CRT Scanline Effect */
        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(
                to bottom,
                rgba(255,255,255,0),
                rgba(255,255,255,0) 50%,
                rgba(0,0,0,0.1) 50%,
                rgba(0,0,0,0.1)
            );
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 9999;
            opacity: 0.3;
        }

        /* Modal Styles */
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
        }

        /* Table Styles */
        .table-row-hover:hover {
            background: rgba(0, 240, 255, 0.05);
            border-color: rgba(0, 240, 255, 0.3);
        }

        /* Loading Screen Styles */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #030712 0%, #0a1628 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 99999;
            transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
        }
        
        .loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .loader-rings {
            position: relative;
            width: 120px;
            height: 120px;
        }

        .loader-ring {
            position: absolute;
            border: 3px solid transparent;
            border-radius: 50%;
            animation: rotate 2s linear infinite;
        }

        .loader-ring:nth-child(1) {
            width: 120px;
            height: 120px;
            border-top-color: #00f0ff;
            animation-duration: 2s;
        }

        .loader-ring:nth-child(2) {
            width: 100px;
            height: 100px;
            top: 10px;
            left: 10px;
            border-top-color: #bd00ff;
            animation-duration: 1.5s;
            animation-direction: reverse;
        }

        .loader-ring:nth-child(3) {
            width: 80px;
            height: 80px;
            top: 20px;
            left: 20px;
            border-top-color: #ff003c;
            animation-duration: 1s;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 40px;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #00f0ff, #bd00ff, #ff003c, #00f0ff);
            background-size: 200% 100%;
            animation: shimmer 2s linear infinite;
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .loading-text {
            color: #00f0ff;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            margin-top: 24px;
            letter-spacing: 2px;
            animation: glow 2s ease-in-out infinite;
        }

        .loading-dots::after {
            content: '';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="flex flex-col items-center">
            <div class="loader-rings">
                <div class="loader-ring"></div>
                <div class="loader-ring"></div>
                <div class="loader-ring"></div>
            </div>
            <div class="loading-progress">
                <div id="loading-progress-bar" class="loading-progress-bar" style="width: 0%"></div>
            </div>
            <div class="loading-text">
                <span id="loading-text">INITIALIZING SYSTEM</span><span class="loading-dots"></span>
            </div>
        </div>
    </div>

    <div class="cyber-grid"></div>
    <div class="scanlines"></div>
    <div id="root"></div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD74hSR_EipAUN9tvSN8lLe6hGJ6p-UzSM",
            authDomain: "cybershield-fa262.firebaseapp.com",
            databaseURL: "https://cybershield-fa262-default-rtdb.asia-southeast1.firebasedatabase.app/",
            projectId: "cybershield-fa262",
            storageBucket: "cybershield-fa262.firebasestorage.app",
            messagingSenderId: "1095310557329",
            appId: "1:1095310557329:web:b91d2dd48ef112c0fa3f30",
            measurementId: "G-H8LDB4XLB1"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const database = firebase.database();

        // Loading Screen Controller
        const loadingSteps = [
            { text: 'INITIALIZING SYSTEM', progress: 20 },
            { text: 'AUTHENTICATING ADMIN', progress: 40 },
            { text: 'LOADING SECURITY DATA', progress: 60 },
            { text: 'SYNCING DATABASE', progress: 80 },
            { text: 'ADMIN PANEL READY', progress: 100 }
        ];

        let currentStep = 0;

        function updateLoadingScreen() {
            const loadingScreen = document.getElementById('loading-screen');
            const loadingText = document.getElementById('loading-text');
            const progressBar = document.getElementById('loading-progress-bar');

            if (currentStep < loadingSteps.length) {
                const step = loadingSteps[currentStep];
                loadingText.textContent = step.text;
                progressBar.style.width = step.progress + '%';
                currentStep++;
                setTimeout(updateLoadingScreen, 500);
            } else {
                setTimeout(() => {
                    loadingScreen.classList.add('hidden');
                }, 300);
            }
        }

        // Start loading animation
        setTimeout(updateLoadingScreen, 300);
    </script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const ANALYSTS = ['Analyst-01', 'Analyst-02', 'Analyst-03', 'Analyst-04'];

        // --- COMPONENTS ---

        // Sidebar Navigation
        const Sidebar = ({ activeTab }) => {
            const menuItems = [
                { id: 'dashboard', icon: 'fa-chart-pie', label: 'Overview', link: 'dashboard.html' },
                { id: 'report', icon: 'fa-file-shield', label: 'Report Threat', link: 'report-page.html' },
                { id: 'admin', icon: 'fa-user-shield', label: 'Admin Panel', link: 'admin-panel.html' },
            ];

            const handleNavigation = (link) => {
                window.location.href = link;
            };

            return (
                <div className="w-20 lg:w-64 h-screen fixed left-0 top-0 glass-panel border-r border-white/10 flex flex-col z-50 transition-all duration-300">
                    <div className="p-6 flex items-center gap-3 justify-center lg:justify-start">
                        <i className="fa-solid fa-shield-virus text-3xl text-cyber-blue animate-pulse-fast"></i>
                        <span className="hidden lg:block text-xl font-bold tracking-wider text-white">
                            CYBER<span className="text-cyber-blue">SHIELD</span>
                        </span>
                    </div>

                    <div className="flex-1 py-8 flex flex-col gap-2">
                        {menuItems.map(item => (
                            <button
                                key={item.id}
                                onClick={() => handleNavigation(item.link)}
                                className={`
                                    flex items-center gap-4 px-6 py-4 transition-all duration-300 relative overflow-hidden group
                                    ${activeTab === item.id ? 'text-cyber-blue bg-white/5' : 'text-slate-400 hover:text-white hover:bg-white/5'}
                                `}
                            >
                                {activeTab === item.id && (
                                    <div className="absolute left-0 top-0 bottom-0 w-1 bg-cyber-blue shadow-[0_0_15px_rgba(0,240,255,0.8)]"></div>
                                )}
                                <i className={`fa-solid ${item.icon} text-xl w-6 text-center`}></i>
                                <span className="hidden lg:block font-medium tracking-wide">{item.label}</span>
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        // Filter Panel Component
        const FilterPanel = ({ filters, setFilters, onReset }) => {
            return (
                <div className="glass-panel rounded-2xl p-6 animate-fadeIn">
                    <div className="flex items-center justify-between mb-6">
                        <h3 className="text-lg font-bold text-white flex items-center gap-2">
                            <i className="fa-solid fa-filter text-cyber-blue"></i>
                            Advanced Filters
                        </h3>
                        <button 
                            onClick={onReset}
                            className="text-xs text-slate-400 hover:text-cyber-blue transition-colors"
                        >
                            Reset All
                        </button>
                    </div>

                    <div className="space-y-4">
                        {/* Search */}
                        <div>
                            <label className="text-xs font-mono text-slate-400 uppercase tracking-wider mb-2 block">
                                Full-Text Search
                            </label>
                            <div className="relative">
                                <i className="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"></i>
                                <input
                                    type="text"
                                    value={filters.search}
                                    onChange={(e) => setFilters({...filters, search: e.target.value})}
                                    placeholder="Search reports..."
                                    className="w-full pl-10 pr-4 py-2.5 bg-white/5 border border-white/10 rounded-lg text-white placeholder-slate-500 focus:border-cyber-blue focus:outline-none transition-colors"
                                />
                            </div>
                        </div>

                        {/* Incident Type */}
                        <div>
                            <label className="text-xs font-mono text-slate-400 uppercase tracking-wider mb-2 block">
                                Incident Type
                            </label>
                            <select
                                value={filters.type}
                                onChange={(e) => setFilters({...filters, type: e.target.value})}
                                className="w-full px-4 py-2.5 bg-white/5 border border-white/10 rounded-lg text-white focus:border-cyber-blue focus:outline-none transition-colors"
                            >
                                <option value="">All Types</option>
                                <option value="phishing">Phishing</option>
                                <option value="malware">Malware / Ransomware</option>
                                <option value="ddos">DDoS Attack</option>
                                <option value="breach">Data Breach</option>
                                <option value="unauthorized">Unauthorized Access</option>
                                <option value="suspicious">Suspicious Activity</option>
                                <option value="other">Other</option>
                            </select>
                        </div>

                        {/* Severity */}
                        <div>
                            <label className="text-xs font-mono text-slate-400 uppercase tracking-wider mb-2 block">
                                Severity Level
                            </label>
                            <select
                                value={filters.severity}
                                onChange={(e) => setFilters({...filters, severity: e.target.value})}
                                className="w-full px-4 py-2.5 bg-white/5 border border-white/10 rounded-lg text-white focus:border-cyber-blue focus:outline-none transition-colors"
                            >
                                <option value="">All Levels</option>
                                <option value="low">Low</option>
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                            </select>
                        </div>

                        {/* Status */}
                        <div>
                            <label className="text-xs font-mono text-slate-400 uppercase tracking-wider mb-2 block">
                                Status
                            </label>
                            <select
                                value={filters.status}
                                onChange={(e) => setFilters({...filters, status: e.target.value})}
                                className="w-full px-4 py-2.5 bg-white/5 border border-white/10 rounded-lg text-white focus:border-cyber-blue focus:outline-none transition-colors"
                            >
                                <option value="">All Statuses</option>
                                <option value="submitted">Submitted</option>
                                <option value="under_review">Under Review</option>
                                <option value="action_taken">Action Taken</option>
                                <option value="closed">Closed</option>
                            </select>
                        </div>

                        {/* Assigned To */}
                        <div>
                            <label className="text-xs font-mono text-slate-400 uppercase tracking-wider mb-2 block">
                                Assigned To
                            </label>
                            <select
                                value={filters.assignedTo}
                                onChange={(e) => setFilters({...filters, assignedTo: e.target.value})}
                                className="w-full px-4 py-2.5 bg-white/5 border border-white/10 rounded-lg text-white focus:border-cyber-blue focus:outline-none transition-colors"
                            >
                                <option value="">All Analysts</option>
                                <option value="unassigned">Unassigned</option>
                                {ANALYSTS.map(analyst => (
                                    <option key={analyst} value={analyst}>{analyst}</option>
                                ))}
                            </select>
                        </div>
                    </div>
                </div>
            );
        };

        // Incident Detail Modal
        const IncidentDetailModal = ({ incident, onClose, onUpdate }) => {
            const [assignedTo, setAssignedTo] = useState(incident.assignedTo || '');
            const [newComment, setNewComment] = useState('');

            if (!incident) return null;

            const handleAssign = () => {
                onUpdate(incident.firebaseKey, { assignedTo });
            };

            const handleAddComment = () => {
                if (newComment.trim()) {
                    const comment = {
                        analyst: 'Admin User',
                        text: newComment,
                        time: new Date().toLocaleString()
                    };
                    const updatedComments = [...(incident.adminComments || []), comment];
                    onUpdate(incident.firebaseKey, { adminComments: updatedComments });
                    setNewComment('');
                }
            };

            const handleStatusChange = (newStatus) => {
                onUpdate(incident.firebaseKey, { status: newStatus });
            };

            const getSeverityColor = (severity) => {
                switch(severity?.toLowerCase()) {
                    case 'high': return 'bg-red-500/20 text-red-400 border-red-500/30';
                    case 'medium': return 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30';
                    case 'low': return 'bg-green-500/20 text-green-400 border-green-500/30';
                    default: return 'bg-blue-500/20 text-blue-400 border-blue-500/30';
                }
            };

            const getStatusColor = (status) => {
                switch(status) {
                    case 'submitted': return 'bg-green-500/20 text-green-400 border-green-500/30';
                    case 'under_review': return 'bg-blue-500/20 text-blue-400 border-blue-500/30';
                    case 'action_taken': return 'bg-purple-500/20 text-purple-400 border-purple-500/30';
                    case 'closed': return 'bg-slate-500/20 text-slate-400 border-slate-500/30';
                    default: return 'bg-slate-500/20 text-slate-400 border-slate-500/30';
                }
            };

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop animate-fadeIn" onClick={onClose}>
                    <div className="glass-panel rounded-2xl max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col animate-slideUp" onClick={(e) => e.stopPropagation()}>
                        {/* Header */}
                        <div className="p-6 border-b border-white/10 flex items-start justify-between">
                            <div className="flex-1">
                                <div className="flex items-center gap-3 mb-2">
                                    <h2 className="text-2xl font-bold text-white font-mono">{incident.id}</h2>
                                    <span className={`text-xs font-bold px-3 py-1 rounded border ${getSeverityColor(incident.data?.severity)}`}>
                                        {incident.data?.severity?.toUpperCase() || 'MEDIUM'}
                                    </span>
                                    <span className={`text-xs font-bold px-3 py-1 rounded border ${getStatusColor(incident.status)}`}>
                                        {incident.status?.replace('_', ' ').toUpperCase() || 'PENDING'}
                                    </span>
                                </div>
                                <p className="text-slate-400 text-sm">
                                    <span className="font-mono">{incident.data?.incidentType}</span> â€¢ Reported {incident.submittedDate}
                                </p>
                            </div>
                            <button 
                                onClick={onClose}
                                className="text-slate-400 hover:text-white transition-colors"
                            >
                                <i className="fa-solid fa-xmark text-2xl"></i>
                            </button>
                        </div>

                        {/* Content */}
                        <div className="flex-1 overflow-y-auto p-6">
                            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                {/* Main Info */}
                                <div className="lg:col-span-2 space-y-6">
                                    {/* Report Details Grid */}
                                    <div className="grid grid-cols-2 gap-4">
                                        <div className="p-4 rounded-lg bg-white/5 border border-white/10">
                                            <p className="text-xs text-slate-400 mb-1">Incident Type</p>
                                            <p className="text-white font-medium">{incident.data?.incidentType || 'N/A'}</p>
                                        </div>

                                        <div className="p-4 rounded-lg bg-white/5 border border-white/10">
                                            <p className="text-xs text-slate-400 mb-1">Affected Assets</p>
                                            <p className="text-white font-medium">{incident.data?.affectedAssets || 'N/A'}</p>
                                        </div>

                                        <div className="p-4 rounded-lg bg-white/5 border border-white/10">
                                            <p className="text-xs text-slate-400 mb-1">IP Address</p>
                                            <p className="text-white font-medium font-mono">{incident.data?.ipAddress || 'Not provided'}</p>
                                        </div>

                                        {incident.data?.timestamp && (
                                            <div className="p-4 rounded-lg bg-white/5 border border-white/10">
                                                <p className="text-xs text-slate-400 mb-1">Incident Time</p>
                                                <p className="text-white font-medium text-sm">{new Date(incident.data.timestamp).toLocaleString()}</p>
                                            </div>
                                        )}

                                        {!incident.data?.anonymous && (
                                            <>
                                                <div className="p-4 rounded-lg bg-white/5 border border-white/10">
                                                    <p className="text-xs text-slate-400 mb-1">Reporter</p>
                                                    <p className="text-white font-medium">{incident.data?.reporter || 'N/A'}</p>
                                                </div>

                                                <div className="p-4 rounded-lg bg-white/5 border border-white/10">
                                                    <p className="text-xs text-slate-400 mb-1">Contact Email</p>
                                                    <p className="text-white font-medium text-sm">{incident.data?.email || 'N/A'}</p>
                                                </div>
                                            </>
                                        )}
                                    </div>

                                    {/* Description */}
                                    {incident.data?.description && (
                                        <div>
                                            <h3 className="text-sm font-mono text-slate-400 uppercase tracking-wider mb-2">Incident Description</h3>
                                            <div className="p-4 rounded-lg bg-white/5 border border-white/10">
                                                <p className="text-white leading-relaxed">{incident.data.description}</p>
                                            </div>
                                        </div>
                                    )}

                                    {/* Evidence Files */}
                                    {incident.files && incident.files.length > 0 && (
                                        <div>
                                            <h3 className="text-sm font-mono text-slate-400 uppercase tracking-wider mb-3 flex items-center gap-2">
                                                <i className="fa-solid fa-folder-open text-cyber-blue"></i>
                                                Evidence Files ({incident.files.length})
                                            </h3>
                                            <div className="space-y-2">
                                                {incident.files.map((file, idx) => (
                                                    <div key={idx} className="p-4 bg-white/5 border border-white/10 rounded-lg hover:border-cyber-blue/50 transition-all">
                                                        <div className="flex items-center justify-between">
                                                            <div className="flex items-center gap-3 flex-1">
                                                                <div className="w-10 h-10 rounded-lg bg-cyber-blue/10 border border-cyber-blue/30 flex items-center justify-center">
                                                                    <i className="fa-solid fa-file text-cyber-blue"></i>
                                                                </div>
                                                                <div className="flex-1">
                                                                    <p className="font-medium text-white">{file.name}</p>
                                                                    <p className="text-xs text-slate-400">{file.size}</p>
                                                                </div>
                                                            </div>
                                                            <button className="px-3 py-2 bg-white/5 border border-white/10 text-slate-400 rounded-lg hover:bg-white/10 transition-all text-sm">
                                                                <i className="fa-solid fa-download"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}

                                    {/* Admin Comments Section */}
                                    <div>
                                        <h3 className="text-sm font-mono text-slate-400 uppercase tracking-wider mb-3">
                                            Admin Notes & Comments
                                        </h3>
                                        <div className="space-y-3 mb-4">
                                            {(!incident.adminComments || incident.adminComments.length === 0) ? (
                                                <p className="text-slate-500 text-sm italic">No admin comments yet</p>
                                            ) : (
                                                incident.adminComments.map((comment, idx) => (
                                                    <div key={idx} className="p-3 bg-white/5 border border-white/10 rounded-lg">
                                                        <div className="flex items-center justify-between mb-2">
                                                            <span className="text-sm font-semibold text-cyber-blue">{comment.analyst}</span>
                                                            <span className="text-xs text-slate-500 font-mono">{comment.time}</span>
                                                        </div>
                                                        <p className="text-slate-300 text-sm">{comment.text}</p>
                                                    </div>
                                                ))
                                            )}
                                        </div>
                                        <div className="flex gap-2">
                                            <input
                                                type="text"
                                                value={newComment}
                                                onChange={(e) => setNewComment(e.target.value)}
                                                onKeyPress={(e) => e.key === 'Enter' && handleAddComment()}
                                                placeholder="Add admin comment..."
                                                className="flex-1 px-4 py-2.5 bg-white/5 border border-white/10 rounded-lg text-white placeholder-slate-500 focus:border-cyber-blue focus:outline-none transition-colors"
                                            />
                                            <button 
                                                onClick={handleAddComment}
                                                className="px-6 py-2.5 bg-cyber-blue text-black font-semibold rounded-lg hover:shadow-[0_0_20px_rgba(0,240,255,0.4)] transition-all"
                                            >
                                                Add
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                {/* Sidebar Actions */}
                                <div className="space-y-6">
                                    {/* Details */}
                                    <div className="p-4 bg-white/5 border border-white/10 rounded-lg">
                                        <h4 className="text-xs font-mono text-slate-400 uppercase tracking-wider mb-3">Details</h4>
                                        <div className="space-y-2 text-sm">
                                            <div>
                                                <span className="text-slate-500">Report ID:</span>
                                                <p className="text-white font-mono text-xs">{incident.id}</p>
                                            </div>
                                            <div>
                                                <span className="text-slate-500">Submitted:</span>
                                                <p className="text-white font-mono text-xs">{incident.submittedDate}</p>
                                            </div>
                                            {incident.data?.containment && (
                                                <div className="mt-2 p-2 bg-red-500/10 border border-red-500/30 rounded">
                                                    <p className="text-xs text-red-400 flex items-center gap-2">
                                                        <i className="fa-solid fa-shield-halved"></i>
                                                        Immediate Containment Requested
                                                    </p>
                                                </div>
                                            )}
                                        </div>
                                    </div>

                                    {/* Assign Analyst */}
                                    <div>
                                        <label className="text-xs font-mono text-slate-400 uppercase tracking-wider mb-2 block">
                                            Assign Analyst
                                        </label>
                                        <div className="flex gap-2">
                                            <select
                                                value={assignedTo}
                                                onChange={(e) => setAssignedTo(e.target.value)}
                                                className="flex-1 px-3 py-2.5 bg-white/5 border border-white/10 rounded-lg text-white focus:border-cyber-blue focus:outline-none transition-colors"
                                            >
                                                <option value="">Unassigned</option>
                                                {ANALYSTS.map(analyst => (
                                                    <option key={analyst} value={analyst}>{analyst}</option>
                                                ))}
                                            </select>
                                            <button 
                                                onClick={handleAssign}
                                                className="px-4 py-2.5 bg-cyber-blue text-black font-semibold rounded-lg hover:shadow-[0_0_20px_rgba(0,240,255,0.4)] transition-all"
                                            >
                                                <i className="fa-solid fa-check"></i>
                                            </button>
                                        </div>
                                    </div>

                                    {/* Status Actions */}
                                    <div>
                                        <label className="text-xs font-mono text-slate-400 uppercase tracking-wider mb-2 block">
                                            Update Status
                                        </label>
                                        <div className="space-y-2">
                                            {['submitted', 'under_review', 'action_taken', 'closed'].map(status => (
                                                <button
                                                    key={status}
                                                    onClick={() => handleStatusChange(status)}
                                                    className={`w-full px-4 py-2.5 rounded-lg border transition-all text-sm font-medium ${
                                                        incident.status === status 
                                                            ? getStatusColor(status)
                                                            : 'bg-white/5 border-white/10 text-slate-400 hover:bg-white/10'
                                                    }`}
                                                >
                                                    {status.replace('_', ' ').toUpperCase()}
                                                </button>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Priority Tagging */}
                                    <div>
                                        <label className="text-xs font-mono text-slate-400 uppercase tracking-wider mb-2 block">
                                            Priority Level
                                        </label>
                                        <div className="grid grid-cols-2 gap-2">
                                            {['low', 'medium', 'high'].map(severity => (
                                                <button
                                                    key={severity}
                                                    onClick={() => onUpdate(incident.firebaseKey, { data: { ...incident.data, severity } })}
                                                    className={`px-3 py-2 rounded-lg border text-xs font-bold transition-all ${
                                                        incident.data?.severity === severity
                                                            ? getSeverityColor(severity)
                                                            : 'bg-white/5 border-white/10 text-slate-400 hover:bg-white/10'
                                                    }`}
                                                >
                                                    {severity.toUpperCase()}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Main Admin Panel
        const AdminPanel = () => {
            const [activeTab, setActiveTab] = useState('admin');
            const [reports, setReports] = useState([]);
            const [selectedReport, setSelectedReport] = useState(null);
            const [loading, setLoading] = useState(true);
            const [filters, setFilters] = useState({
                search: '',
                type: '',
                severity: '',
                status: '',
                assignedTo: ''
            });

            // Load reports from Firebase
            useEffect(() => {
                const reportsRef = database.ref('reports');
                
                const handleData = (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        const formattedList = Object.keys(data).map(key => ({
                            firebaseKey: key,
                            ...data[key]
                        }));
                        
                        // Sort by timestamp (newest first)
                        formattedList.sort((a, b) => {
                            const dateA = new Date(a.submittedTimestamp || 0);
                            const dateB = new Date(b.submittedTimestamp || 0);
                            return dateB - dateA;
                        });

                        setReports(formattedList);
                    } else {
                        setReports([]);
                    }
                    setLoading(false);
                };

                reportsRef.on('value', handleData);

                return () => reportsRef.off('value', handleData);
            }, []);

            const resetFilters = () => {
                setFilters({
                    search: '',
                    type: '',
                    severity: '',
                    status: '',
                    assignedTo: ''
                });
            };

            const filteredReports = reports.filter(report => {
                // Search filter
                if (filters.search) {
                    const searchLower = filters.search.toLowerCase();
                    const matchesId = report.id?.toLowerCase().includes(searchLower);
                    const matchesDescription = report.data?.description?.toLowerCase().includes(searchLower);
                    const matchesReporter = report.data?.reporter?.toLowerCase().includes(searchLower);
                    const matchesAssets = report.data?.affectedAssets?.toLowerCase().includes(searchLower);
                    
                    if (!matchesId && !matchesDescription && !matchesReporter && !matchesAssets) {
                        return false;
                    }
                }
                
                // Type filter
                if (filters.type && report.data?.incidentType !== filters.type) return false;
                
                // Severity filter
                if (filters.severity && report.data?.severity !== filters.severity) return false;
                
                // Status filter
                if (filters.status && report.status !== filters.status) return false;
                
                // Assigned filter
                if (filters.assignedTo) {
                    if (filters.assignedTo === 'unassigned' && report.assignedTo) return false;
                    if (filters.assignedTo !== 'unassigned' && report.assignedTo !== filters.assignedTo) return false;
                }
                
                return true;
            });

            const updateReport = async (firebaseKey, updates) => {
                try {
                    const reportRef = database.ref(`reports/${firebaseKey}`);
                    await reportRef.update(updates);
                    
                    // Update selected report if it's the one being updated
                    if (selectedReport && selectedReport.firebaseKey === firebaseKey) {
                        setSelectedReport({ ...selectedReport, ...updates });
                    }
                } catch (error) {
                    console.error('Error updating report:', error);
                    alert('Failed to update report. Please try again.');
                }
            };

            const getSeverityColor = (severity) => {
                switch(severity?.toLowerCase()) {
                    case 'high': return 'bg-red-500/20 text-red-400 border-red-500/30';
                    case 'medium': return 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30';
                    case 'low': return 'bg-green-500/20 text-green-400 border-green-500/30';
                    default: return 'bg-blue-500/20 text-blue-400 border-blue-500/30';
                }
            };

            const getStatusColor = (status) => {
                switch(status) {
                    case 'submitted': return 'bg-green-500/20 text-green-400 border-green-500/30';
                    case 'under_review': return 'bg-blue-500/20 text-blue-400 border-blue-500/30';
                    case 'action_taken': return 'bg-purple-500/20 text-purple-400 border-purple-500/30';
                    case 'closed': return 'bg-slate-500/20 text-slate-400 border-slate-500/30';
                    default: return 'bg-slate-500/20 text-slate-400 border-slate-500/30';
                }
            };

            // Statistics
            const stats = {
                total: reports.length,
                submitted: reports.filter(r => r.status === 'submitted').length,
                underReview: reports.filter(r => r.status === 'under_review').length,
                high: reports.filter(r => r.data?.severity === 'high').length,
            };

            return (
                <div className="min-h-screen pl-0 lg:pl-64 transition-all duration-300">
                    <Sidebar activeTab={activeTab} />
                    
                    {/* Top Bar */}
                    <header className="h-20 border-b border-white/10 glass-panel sticky top-0 z-40 px-8 flex items-center justify-between">
                        <h2 className="text-xl font-bold text-white tracking-wide">
                            <span className="text-slate-500 font-light">ADMIN CENTER /</span> THREAT REPORT MANAGEMENT
                        </h2>

                        <div className="flex items-center gap-6">
                            <div className="flex items-center gap-2 px-4 py-2 bg-cyber-blue/10 border border-cyber-blue/30 rounded-lg">
                                <div className="w-2 h-2 bg-cyber-blue rounded-full animate-pulse"></div>
                                <span className="text-cyber-blue text-sm font-semibold">{filteredReports.length} Reports</span>
                            </div>
                            <div className="w-10 h-10 rounded-full bg-gradient-to-tr from-cyber-blue to-blue-600 border border-white/20"></div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="p-6 lg:p-8">
                        {/* Stats Cards */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <div className="glass-panel p-6 rounded-2xl animate-fadeIn">
                                <div className="flex justify-between items-start">
                                    <div>
                                        <p className="text-xs font-mono text-slate-400 uppercase tracking-wider">Total Reports</p>
                                        <h3 className="text-3xl font-bold text-white mt-1">{stats.total}</h3>
                                    </div>
                                    <div className="w-10 h-10 rounded-lg flex items-center justify-center border border-cyber-blue/30 bg-cyber-blue/10">
                                        <i className="fa-solid fa-database text-cyber-blue"></i>
                                    </div>
                                </div>
                            </div>

                            <div className="glass-panel p-6 rounded-2xl animate-fadeIn" style={{ animationDelay: '0.1s' }}>
                                <div className="flex justify-between items-start">
                                    <div>
                                        <p className="text-xs font-mono text-slate-400 uppercase tracking-wider">New Submissions</p>
                                        <h3 className="text-3xl font-bold text-white mt-1">{stats.submitted}</h3>
                                    </div>
                                    <div className="w-10 h-10 rounded-lg flex items-center justify-center border border-green-500/30 bg-green-500/10">
                                        <i className="fa-solid fa-folder-open text-green-400"></i>
                                    </div>
                                </div>
                            </div>

                            <div className="glass-panel p-6 rounded-2xl animate-fadeIn" style={{ animationDelay: '0.2s' }}>
                                <div className="flex justify-between items-start">
                                    <div>
                                        <p className="text-xs font-mono text-slate-400 uppercase tracking-wider">Under Review</p>
                                        <h3 className="text-3xl font-bold text-white mt-1">{stats.underReview}</h3>
                                    </div>
                                    <div className="w-10 h-10 rounded-lg flex items-center justify-center border border-blue-500/30 bg-blue-500/10">
                                        <i className="fa-solid fa-magnifying-glass text-blue-400"></i>
                                    </div>
                                </div>
                            </div>

                            <div className="glass-panel p-6 rounded-2xl animate-fadeIn" style={{ animationDelay: '0.3s' }}>
                                <div className="flex justify-between items-start">
                                    <div>
                                        <p className="text-xs font-mono text-slate-400 uppercase tracking-wider">High Priority</p>
                                        <h3 className="text-3xl font-bold text-white mt-1">{stats.high}</h3>
                                    </div>
                                    <div className="w-10 h-10 rounded-lg flex items-center justify-center border border-red-500/30 bg-red-500/10">
                                        <i className="fa-solid fa-triangle-exclamation text-red-400"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Main Content Grid */}
                        <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">
                            {/* Filters Panel */}
                            <div className="lg:col-span-1">
                                <FilterPanel filters={filters} setFilters={setFilters} onReset={resetFilters} />
                            </div>

                            {/* Reports Table */}
                            <div className="lg:col-span-3">
                                <div className="glass-panel rounded-2xl overflow-hidden animate-fadeIn">
                                    <div className="p-6 border-b border-white/10">
                                        <h3 className="text-lg font-bold text-white flex items-center gap-2">
                                            <i className="fa-solid fa-inbox text-cyber-blue"></i>
                                            Threat Reports Inbox
                                        </h3>
                                    </div>

                                    {loading ? (
                                        <div className="p-12 text-center">
                                            <i className="fa-solid fa-circle-notch animate-spin text-3xl text-cyber-blue mb-4"></i>
                                            <p className="text-slate-400">Loading reports from database...</p>
                                        </div>
                                    ) : (
                                        <div className="overflow-x-auto">
                                            <table className="w-full">
                                                <thead className="bg-white/5">
                                                    <tr>
                                                        <th className="px-6 py-4 text-left text-xs font-mono text-slate-400 uppercase tracking-wider">ID</th>
                                                        <th className="px-6 py-4 text-left text-xs font-mono text-slate-400 uppercase tracking-wider">Type</th>
                                                        <th className="px-6 py-4 text-left text-xs font-mono text-slate-400 uppercase tracking-wider">Severity</th>
                                                        <th className="px-6 py-4 text-left text-xs font-mono text-slate-400 uppercase tracking-wider">Status</th>
                                                        <th className="px-6 py-4 text-left text-xs font-mono text-slate-400 uppercase tracking-wider">Assigned</th>
                                                        <th className="px-6 py-4 text-left text-xs font-mono text-slate-400 uppercase tracking-wider">Date</th>
                                                        <th className="px-6 py-4 text-left text-xs font-mono text-slate-400 uppercase tracking-wider">Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {filteredReports.length === 0 ? (
                                                        <tr>
                                                            <td colSpan="7" className="px-6 py-12 text-center text-slate-500">
                                                                <i className="fa-solid fa-inbox text-4xl mb-3 block opacity-20"></i>
                                                                {reports.length === 0 ? 'No reports in database' : 'No reports match your filters'}
                                                            </td>
                                                        </tr>
                                                    ) : (
                                                        filteredReports.map((report) => (
                                                            <tr 
                                                                key={report.firebaseKey} 
                                                                className="border-b border-white/5 table-row-hover transition-all cursor-pointer"
                                                                onClick={() => setSelectedReport(report)}
                                                            >
                                                                <td className="px-6 py-4 font-mono text-sm text-cyber-blue">{report.id}</td>
                                                                <td className="px-6 py-4 text-sm text-white">{report.data?.incidentType || 'N/A'}</td>
                                                                <td className="px-6 py-4">
                                                                    <span className={`text-xs font-bold px-2 py-1 rounded border ${getSeverityColor(report.data?.severity)}`}>
                                                                        {report.data?.severity?.toUpperCase() || 'MEDIUM'}
                                                                    </span>
                                                                </td>
                                                                <td className="px-6 py-4">
                                                                    <span className={`text-xs font-bold px-2 py-1 rounded border ${getStatusColor(report.status)}`}>
                                                                        {report.status?.replace('_', ' ').toUpperCase() || 'PENDING'}
                                                                    </span>
                                                                </td>
                                                                <td className="px-6 py-4 text-sm text-slate-400">
                                                                    {report.assignedTo || <span className="italic">Unassigned</span>}
                                                                </td>
                                                                <td className="px-6 py-4 text-xs font-mono text-slate-400">{report.submittedDate}</td>
                                                                <td className="px-6 py-4">
                                                                    <button 
                                                                        onClick={(e) => {
                                                                            e.stopPropagation();
                                                                            setSelectedReport(report);
                                                                        }}
                                                                        className="px-3 py-1.5 bg-cyber-blue/10 border border-cyber-blue/30 text-cyber-blue rounded-lg hover:bg-cyber-blue/20 transition-all text-sm"
                                                                    >
                                                                        Manage
                                                                    </button>
                                                                </td>
                                                            </tr>
                                                        ))
                                                    )}
                                                </tbody>
                                            </table>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </main>

                    {/* Incident Detail Modal */}
                    {selectedReport && (
                        <IncidentDetailModal 
                            incident={selectedReport}
                            onClose={() => setSelectedReport(null)}
                            onUpdate={updateReport}
                        />
                    )}
                </div>
            );
        };

        ReactDOM.render(<AdminPanel />, document.getElementById('root'));
    </script>
</body>
</html>