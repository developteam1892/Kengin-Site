<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberShield | Dashboard</title>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cyber: {
                            dark: '#050b14',
                            blue: '#00f0ff',
                            purple: '#bd00ff',
                            red: '#ff003c',
                            glass: 'rgba(255, 255, 255, 0.05)'
                        }
                    },
                    animation: {
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'slideIn': 'slideIn 0.3s ease-out',
                        'fadeIn': 'fadeIn 0.5s ease-out',
                        'fadeOut': 'fadeOut 0.5s ease-out',
                        'spin-slow': 'spin 3s linear infinite',
                        'glow': 'glow 2s ease-in-out infinite',
                        'slideUp': 'slideUp 0.3s ease-out',
                        'bounce-slow': 'bounce 2s infinite',
                        'ping-slow': 'ping 2s cubic-bezier(0, 0, 0.2, 1) infinite',
                    },
                    keyframes: {
                        slideIn: {
                            '0%': { transform: 'translateX(-20px)', opacity: '0' },
                            '100%': { transform: 'translateX(0)', opacity: '1' }
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        fadeOut: {
                            '0%': { opacity: '1' },
                            '100%': { opacity: '0' }
                        },
                        glow: {
                            '0%, 100%': { opacity: '1', filter: 'drop-shadow(0 0 10px rgba(0, 240, 255, 0.5))' },
                            '50%': { opacity: '0.8', filter: 'drop-shadow(0 0 20px rgba(0, 240, 255, 0.8))' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Outfit:wght@300;400;600;800&display=swap');
        body { background-color: #030712; color: #e2e8f0; font-family: 'Outfit', sans-serif; overflow-x: hidden; }
        .cyber-grid {
            position: fixed; width: 200%; height: 200%; top: -50%; left: -50%;
            background-image: linear-gradient(transparent 0%, rgba(0, 240, 255, 0.05) 2%, transparent 3%),
            linear-gradient(90deg, transparent 0%, rgba(0, 240, 255, 0.05) 2%, transparent 3%);
            background-size: 50px 50px; transform: perspective(500px) rotateX(60deg);
            animation: grid-move 20s linear infinite; z-index: -1; pointer-events: none;
        }
        @keyframes grid-move {
            0% { transform: perspective(500px) rotateX(60deg) translateY(0); }
            100% { transform: perspective(500px) rotateX(60deg) translateY(50px); }
        }
        .glass-panel {
            background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .glass-panel:hover {
            border-color: rgba(0, 240, 255, 0.3);
        }
        .scanlines {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.1));
            background-size: 100% 4px; pointer-events: none; z-index: 9999; opacity: 0.2;
        }
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #0f172a;
        }
        ::-webkit-scrollbar-thumb {
            background: #1e293b;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #00f0ff;
        }

        /* Loading Screen Styles */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #030712 0%, #0a1628 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 99999;
            transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
        }
        
        .loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .loader-rings {
            position: relative;
            width: 120px;
            height: 120px;
        }

        .loader-ring {
            position: absolute;
            border: 3px solid transparent;
            border-radius: 50%;
            animation: rotate 2s linear infinite;
        }

        .loader-ring:nth-child(1) {
            width: 120px;
            height: 120px;
            border-top-color: #00f0ff;
            animation-duration: 2s;
        }

        .loader-ring:nth-child(2) {
            width: 100px;
            height: 100px;
            top: 10px;
            left: 10px;
            border-top-color: #bd00ff;
            animation-duration: 1.5s;
            animation-direction: reverse;
        }

        .loader-ring:nth-child(3) {
            width: 80px;
            height: 80px;
            top: 20px;
            left: 20px;
            border-top-color: #ff003c;
            animation-duration: 1s;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 40px;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #00f0ff, #bd00ff, #ff003c, #00f0ff);
            background-size: 200% 100%;
            animation: shimmer 2s linear infinite;
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .loading-text {
            color: #00f0ff;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            margin-top: 24px;
            letter-spacing: 2px;
            animation: glow 2s ease-in-out infinite;
        }

        .loading-dots::after {
            content: '';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }

        .emoji-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 12px;
            max-height: 400px;
            overflow-y: auto;
            padding: 4px;
        }

        .emoji-option {
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            cursor: pointer;
            border-radius: 12px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.03);
        }

        .emoji-option:hover {
            background: rgba(0, 240, 255, 0.1);
            border-color: rgba(0, 240, 255, 0.3);
            transform: scale(1.1);
        }

        .emoji-option.selected {
            background: rgba(0, 240, 255, 0.2);
            border-color: #00f0ff;
            box-shadow: 0 0 20px rgba(0, 240, 255, 0.3);
        }

        .notification-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            width: 8px;
            height: 8px;
            background: #ff003c;
            border-radius: 50%;
            border: 2px solid #0f172a;
            animation: ping-slow 2s cubic-bezier(0, 0, 0.2, 1) infinite;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="flex flex-col items-center">
            <div class="loader-rings">
                <div class="loader-ring"></div>
                <div class="loader-ring"></div>
                <div class="loader-ring"></div>
            </div>
            <div class="loading-progress">
                <div id="loading-progress-bar" class="loading-progress-bar" style="width: 0%"></div>
            </div>
            <div class="loading-text">
                <span id="loading-text">INITIALIZING SYSTEM</span><span class="loading-dots"></span>
            </div>
        </div>
    </div>

    <div class="cyber-grid"></div>
    <div class="scanlines"></div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Loading Screen Controller
        const loadingSteps = [
            { text: 'INITIALIZING SYSTEM', progress: 20 },
            { text: 'CONNECTING TO DATABASE', progress: 40 },
            { text: 'LOADING SECURITY PROTOCOLS', progress: 60 },
            { text: 'SYNCHRONIZING DATA', progress: 80 },
            { text: 'LAUNCHING DASHBOARD', progress: 100 }
        ];

        let currentStep = 0;

        function updateLoadingScreen() {
            const loadingScreen = document.getElementById('loading-screen');
            const loadingText = document.getElementById('loading-text');
            const progressBar = document.getElementById('loading-progress-bar');

            if (currentStep < loadingSteps.length) {
                const step = loadingSteps[currentStep];
                loadingText.textContent = step.text;
                progressBar.style.width = step.progress + '%';
                currentStep++;
                setTimeout(updateLoadingScreen, 500);
            } else {
                setTimeout(() => {
                    loadingScreen.classList.add('hidden');
                }, 300);
            }
        }

        // Start loading animation
        setTimeout(updateLoadingScreen, 300);

        // --- FIREBASE CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyD74hSR_EipAUN9tvSN8lLe6hGJ6p-UzSM",
            authDomain: "cybershield-fa262.firebaseapp.com",
            projectId: "cybershield-fa262",
            databaseURL: "https://cybershield-fa262-default-rtdb.asia-southeast1.firebasedatabase.app/",
            storageBucket: "cybershield-fa262.firebasestorage.app",
            messagingSenderId: "1095310557329",
            appId: "1:1095310557329:web:b91d2dd48ef112c0fa3f30",
            measurementId: "G-H8LDB4XLB1"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const database = firebase.database();
        const auth = firebase.auth();

        // 3D Emoji Collection
        const EMOJI_COLLECTION = [
            'ðŸš€', 'ðŸŽ®', 'ðŸŽ¯', 'âš¡', 'ðŸ”¥', 'ðŸ’Ž', 'ðŸ‘‘', 'ðŸ¦„',
            'ðŸ¤–', 'ðŸ‘¾', 'ðŸŽ¨', 'ðŸŽ­', 'ðŸŽª', 'ðŸŽ¬', 'ðŸŽ¸', 'ðŸŽ¹',
            'ðŸŒŸ', 'â­', 'âœ¨', 'ðŸ’«', 'ðŸŒˆ', 'ðŸŽ†', 'ðŸŽ‡', 'ðŸŽ‰',
            'ðŸ¦Š', 'ðŸº', 'ðŸ¦', 'ðŸ¯', 'ðŸ¼', 'ðŸ¨', 'ðŸ¹', 'ðŸ°',
            'ðŸ•', 'ðŸ”', 'ðŸŸ', 'ðŸŒ®', 'ðŸ¿', 'ðŸ©', 'ðŸª', 'ðŸŽ‚',
            'âš½', 'ðŸ€', 'ðŸŽ¾', 'ðŸˆ', 'âš¾', 'ðŸŽ±', 'ðŸ“', 'ðŸŽ³',
            'ðŸŽ“', 'ðŸ“š', 'ðŸ’¼', 'ðŸ’»', 'ðŸ“±', 'ðŸ–¥ï¸', 'âŒš', 'ðŸ“·'
        ];

        // Sample Notifications Data
        const SAMPLE_NOTIFICATIONS = [
            {
                id: 'notif1',
                type: 'alert',
                title: 'High Severity Threat Detected',
                message: 'A new high-severity phishing attempt has been reported affecting your network.',
                timestamp: new Date(Date.now() - 1000 * 60 * 15).toISOString(), // 15 mins ago
                read: false,
                icon: 'fa-triangle-exclamation',
                color: 'red'
            },
            {
                id: 'notif2',
                type: 'success',
                title: 'Report Review Completed',
                message: 'Your submitted threat report #TR-2024-0123 has been reviewed and marked as resolved.',
                timestamp: new Date(Date.now() - 1000 * 60 * 60 * 2).toISOString(), // 2 hours ago
                read: false,
                icon: 'fa-check-circle',
                color: 'green'
            },
            {
                id: 'notif3',
                type: 'info',
                title: 'System Update Available',
                message: 'CyberShield v2.5.0 is now available with enhanced threat detection capabilities.',
                timestamp: new Date(Date.now() - 1000 * 60 * 60 * 5).toISOString(), // 5 hours ago
                read: false,
                icon: 'fa-info-circle',
                color: 'blue'
            },
            {
                id: 'notif4',
                type: 'warning',
                title: 'Unusual Activity Detected',
                message: 'Multiple login attempts detected from an unknown IP address. Please verify your account security.',
                timestamp: new Date(Date.now() - 1000 * 60 * 60 * 24).toISOString(), // 1 day ago
                read: true,
                icon: 'fa-exclamation-triangle',
                color: 'yellow'
            },
            {
                id: 'notif5',
                type: 'success',
                title: 'Security Scan Complete',
                message: 'Weekly security scan completed successfully. No vulnerabilities detected.',
                timestamp: new Date(Date.now() - 1000 * 60 * 60 * 48).toISOString(), // 2 days ago
                read: true,
                icon: 'fa-shield-check',
                color: 'green'
            }
        ];

        // --- COMPONENTS ---

        const SecurityModal = ({ onClose }) => {
            return (
                <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-[9999] flex items-center justify-center p-4 animate-fadeIn" onClick={onClose}>
                    <div className="glass-panel rounded-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto p-8 animate-slideUp" onClick={(e) => e.stopPropagation()}>
                        {/* Header */}
                        <div className="flex items-start justify-between mb-6">
                            <div>
                                <h2 className="text-2xl font-bold text-white mb-2 flex items-center gap-2">
                                    <i className="fa-solid fa-shield text-cyber-purple"></i>
                                    Security Details
                                </h2>
                                <p className="text-sm text-slate-400">CyberShield Platform Security Information</p>
                            </div>
                            <button 
                                onClick={onClose}
                                className="w-10 h-10 rounded-lg border border-white/20 hover:bg-white/5 transition flex items-center justify-center"
                            >
                                <i className="fa-solid fa-xmark text-xl"></i>
                            </button>
                        </div>

                        {/* Security Status */}
                        <div className="mb-8 p-6 rounded-xl bg-green-500/10 border border-green-500/30 flex items-center gap-4">
                            <div className="w-16 h-16 rounded-full bg-green-500/20 flex items-center justify-center">
                                <i className="fa-solid fa-shield-check text-green-400 text-3xl"></i>
                            </div>
                            <div className="flex-1">
                                <h3 className="text-lg font-bold text-green-400 mb-1">Secure Connection Active</h3>
                                <p className="text-sm text-green-300/80">All communications are encrypted with TLS 1.3</p>
                            </div>
                        </div>

                        {/* Security Features Grid */}
                        <div className="mb-8">
                            <h3 className="text-sm text-slate-400 mb-4 uppercase tracking-wider font-bold">Security Features</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div className="p-4 rounded-xl bg-white/5 border border-white/10">
                                    <div className="flex items-center gap-3 mb-2">
                                        <i className="fa-solid fa-lock text-cyber-blue text-xl"></i>
                                        <h4 className="font-bold text-white">End-to-End Encryption</h4>
                                    </div>
                                    <p className="text-sm text-slate-400">All data is encrypted using AES-256 encryption standards.</p>
                                </div>

                                <div className="p-4 rounded-xl bg-white/5 border border-white/10">
                                    <div className="flex items-center gap-3 mb-2">
                                        <i className="fa-solid fa-user-shield text-cyber-purple text-xl"></i>
                                        <h4 className="font-bold text-white">Two-Factor Authentication</h4>
                                    </div>
                                    <p className="text-sm text-slate-400">Optional 2FA available for enhanced account security.</p>
                                </div>

                                <div className="p-4 rounded-xl bg-white/5 border border-white/10">
                                    <div className="flex items-center gap-3 mb-2">
                                        <i className="fa-solid fa-database text-green-400 text-xl"></i>
                                        <h4 className="font-bold text-white">Secure Data Storage</h4>
                                    </div>
                                    <p className="text-sm text-slate-400">Data stored in Firebase with strict access controls.</p>
                                </div>

                                <div className="p-4 rounded-xl bg-white/5 border border-white/10">
                                    <div className="flex items-center gap-3 mb-2">
                                        <i className="fa-solid fa-eye-slash text-yellow-400 text-xl"></i>
                                        <h4 className="font-bold text-white">Anonymous Reporting</h4>
                                    </div>
                                    <p className="text-sm text-slate-400">Submit threat reports anonymously without tracking.</p>
                                </div>

                                <div className="p-4 rounded-xl bg-white/5 border border-white/10">
                                    <div className="flex items-center gap-3 mb-2">
                                        <i className="fa-solid fa-server text-cyber-blue text-xl"></i>
                                        <h4 className="font-bold text-white">DDoS Protection</h4>
                                    </div>
                                    <p className="text-sm text-slate-400">Advanced protection against distributed denial-of-service attacks.</p>
                                </div>

                                <div className="p-4 rounded-xl bg-white/5 border border-white/10">
                                    <div className="flex items-center gap-3 mb-2">
                                        <i className="fa-solid fa-clock-rotate-left text-purple-400 text-xl"></i>
                                        <h4 className="font-bold text-white">Activity Monitoring</h4>
                                    </div>
                                    <p className="text-sm text-slate-400">Real-time monitoring of all account activities.</p>
                                </div>
                            </div>
                        </div>

                        {/* SSL Certificate Info */}
                        <div className="mb-8 p-6 rounded-xl bg-white/5 border border-white/10">
                            <h3 className="text-sm text-slate-400 mb-4 uppercase tracking-wider font-bold flex items-center gap-2">
                                <i className="fa-solid fa-certificate text-cyber-blue"></i>
                                SSL Certificate Details
                            </h3>
                            <div className="space-y-3">
                                <div className="flex justify-between items-center">
                                    <span className="text-slate-400">Issued To:</span>
                                    <span className="text-white font-mono">cybershield-fa262.firebaseapp.com</span>
                                </div>
                                <div className="flex justify-between items-center">
                                    <span className="text-slate-400">Issued By:</span>
                                    <span className="text-white font-mono">Google Trust Services</span>
                                </div>
                                <div className="flex justify-between items-center">
                                    <span className="text-slate-400">Valid Until:</span>
                                    <span className="text-white font-mono">December 2025</span>
                                </div>
                                <div className="flex justify-between items-center">
                                    <span className="text-slate-400">Encryption:</span>
                                    <span className="text-green-400 font-mono">TLS 1.3 (256-bit)</span>
                                </div>
                            </div>
                        </div>

                        {/* Compliance */}
                        <div className="mb-8">
                            <h3 className="text-sm text-slate-400 mb-4 uppercase tracking-wider font-bold">Compliance & Standards</h3>
                            <div className="flex flex-wrap gap-3">
                                <span className="px-4 py-2 rounded-full bg-cyber-blue/10 border border-cyber-blue/30 text-cyber-blue text-sm font-mono">
                                    ISO 27001
                                </span>
                                <span className="px-4 py-2 rounded-full bg-cyber-purple/10 border border-cyber-purple/30 text-cyber-purple text-sm font-mono">
                                    GDPR Compliant
                                </span>
                                <span className="px-4 py-2 rounded-full bg-green-400/10 border border-green-400/30 text-green-400 text-sm font-mono">
                                    SOC 2 Type II
                                </span>
                                <span className="px-4 py-2 rounded-full bg-yellow-400/10 border border-yellow-400/30 text-yellow-400 text-sm font-mono">
                                    NIST Framework
                                </span>
                            </div>
                        </div>

                        {/* Privacy Notice */}
                        <div className="p-4 rounded-xl bg-cyber-blue/10 border border-cyber-blue/30">
                            <p className="text-sm text-cyber-blue flex items-start gap-2">
                                <i className="fa-solid fa-info-circle mt-1"></i>
                                <span>
                                    We take your privacy seriously. All personal data is encrypted and never shared with third parties. 
                                    For more information, please review our Privacy Policy and Terms of Service.
                                </span>
                            </p>
                        </div>

                        <div className="mt-6 flex justify-end">
                            <button 
                                onClick={onClose}
                                className="px-6 py-3 bg-gradient-to-r from-cyber-purple to-purple-600 rounded-xl font-bold text-white hover:shadow-[0_0_30px_rgba(189,0,255,0.5)] transition-all"
                            >
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const NotificationsModal = ({ onClose, notifications, onMarkAsRead, onMarkAllAsRead }) => {
            const getTimeAgo = (timestamp) => {
                const now = new Date();
                const time = new Date(timestamp);
                const diff = Math.floor((now - time) / 1000); // seconds

                if (diff < 60) return 'Just now';
                if (diff < 3600) return `${Math.floor(diff / 60)} minutes ago`;
                if (diff < 86400) return `${Math.floor(diff / 3600)} hours ago`;
                if (diff < 604800) return `${Math.floor(diff / 86400)} days ago`;
                return time.toLocaleDateString();
            };

            const getIconColor = (color) => {
                switch(color) {
                    case 'red': return 'text-red-400 bg-red-500/10 border-red-500/30';
                    case 'green': return 'text-green-400 bg-green-500/10 border-green-500/30';
                    case 'blue': return 'text-cyber-blue bg-cyber-blue/10 border-cyber-blue/30';
                    case 'yellow': return 'text-yellow-400 bg-yellow-500/10 border-yellow-500/30';
                    default: return 'text-slate-400 bg-slate-500/10 border-slate-500/30';
                }
            };

            const unreadCount = notifications.filter(n => !n.read).length;

            return (
                <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-[9999] flex items-center justify-center p-4 animate-fadeIn" onClick={onClose}>
                    <div className="glass-panel rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col animate-slideUp" onClick={(e) => e.stopPropagation()}>
                        {/* Header */}
                        <div className="p-6 border-b border-white/10">
                            <div className="flex items-start justify-between mb-4">
                                <div>
                                    <h2 className="text-2xl font-bold text-white mb-2 flex items-center gap-2">
                                        <i className="fa-solid fa-bell text-yellow-400"></i>
                                        Notifications
                                    </h2>
                                    <p className="text-sm text-slate-400">
                                        {unreadCount > 0 ? `${unreadCount} unread notification${unreadCount !== 1 ? 's' : ''}` : 'All caught up!'}
                                    </p>
                                </div>
                                <button 
                                    onClick={onClose}
                                    className="w-10 h-10 rounded-lg border border-white/20 hover:bg-white/5 transition flex items-center justify-center"
                                >
                                    <i className="fa-solid fa-xmark text-xl"></i>
                                </button>
                            </div>

                            {unreadCount > 0 && (
                                <button 
                                    onClick={onMarkAllAsRead}
                                    className="text-sm text-cyber-blue hover:text-cyber-blue/80 transition flex items-center gap-2"
                                >
                                    <i className="fa-solid fa-check-double"></i>
                                    Mark all as read
                                </button>
                            )}
                        </div>

                        {/* Notifications List */}
                        <div className="flex-1 overflow-y-auto p-6 space-y-3">
                            {notifications.length === 0 ? (
                                <div className="h-full flex flex-col items-center justify-center text-slate-500 py-12">
                                    <i className="fa-solid fa-bell-slash text-5xl mb-4 opacity-20"></i>
                                    <p className="font-bold text-lg mb-2">No Notifications</p>
                                    <p className="text-sm">You're all caught up!</p>
                                </div>
                            ) : (
                                notifications.map((notif) => (
                                    <div 
                                        key={notif.id}
                                        onClick={() => onMarkAsRead(notif.id)}
                                        className={`p-4 rounded-xl border transition-all cursor-pointer ${
                                            notif.read 
                                                ? 'bg-white/5 border-white/10 hover:bg-white/10' 
                                                : 'bg-cyber-blue/5 border-cyber-blue/20 hover:bg-cyber-blue/10'
                                        }`}
                                    >
                                        <div className="flex gap-3">
                                            <div className={`w-12 h-12 rounded-lg border flex items-center justify-center flex-shrink-0 ${getIconColor(notif.color)}`}>
                                                <i className={`fa-solid ${notif.icon} text-xl`}></i>
                                            </div>
                                            <div className="flex-1 min-w-0">
                                                <div className="flex items-start justify-between gap-2 mb-1">
                                                    <h4 className={`font-bold ${notif.read ? 'text-slate-300' : 'text-white'}`}>
                                                        {notif.title}
                                                    </h4>
                                                    {!notif.read && (
                                                        <span className="w-2 h-2 bg-cyber-blue rounded-full flex-shrink-0 mt-2"></span>
                                                    )}
                                                </div>
                                                <p className="text-sm text-slate-400 mb-2">{notif.message}</p>
                                                <div className="flex items-center gap-2 text-xs text-slate-500">
                                                    <i className="fa-solid fa-clock"></i>
                                                    <span>{getTimeAgo(notif.timestamp)}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const AccountSettingsModal = ({ user, onClose, onUpdate }) => {
            const [displayName, setDisplayName] = useState(user.displayName || '');
            const [selectedEmoji, setSelectedEmoji] = useState(
                localStorage.getItem(`userEmoji_${user.uid}`) || 'ðŸš€'
            );
            const [saving, setSaving] = useState(false);
            const [success, setSuccess] = useState(false);

            const handleSave = async () => {
                setSaving(true);
                try {
                    // Update Firebase Auth profile
                    await user.updateProfile({
                        displayName: displayName
                    });

                    // Save emoji to localStorage
                    localStorage.setItem(`userEmoji_${user.uid}`, selectedEmoji);

                    // Also save to Realtime Database for persistence
                    await database.ref(`users/${user.uid}/profile`).set({
                        displayName: displayName,
                        emoji: selectedEmoji,
                        lastUpdated: new Date().toISOString()
                    });

                    setSuccess(true);
                    setTimeout(() => {
                        onUpdate();
                        onClose();
                    }, 1500);
                } catch (error) {
                    console.error('Error updating profile:', error);
                    alert('Failed to update profile. Please try again.');
                } finally {
                    setSaving(false);
                }
            };

            return (
                <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-[9999] flex items-center justify-center p-4 animate-fadeIn" onClick={onClose}>
                    <div className="glass-panel rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-8 animate-slideUp" onClick={(e) => e.stopPropagation()}>
                        {/* Header */}
                        <div className="flex items-start justify-between mb-6">
                            <div>
                                <h2 className="text-2xl font-bold text-white mb-2 flex items-center gap-2">
                                    <i className="fa-solid fa-user-gear text-cyber-blue"></i>
                                    Account Settings
                                </h2>
                                <p className="text-sm text-slate-400">Customize your profile</p>
                            </div>
                            <button 
                                onClick={onClose}
                                className="w-10 h-10 rounded-lg border border-white/20 hover:bg-white/5 transition flex items-center justify-center"
                            >
                                <i className="fa-solid fa-xmark text-xl"></i>
                            </button>
                        </div>

                        {success && (
                            <div className="mb-6 p-4 rounded-xl bg-green-500/20 border border-green-500/50 flex items-center gap-3 animate-slideIn">
                                <i className="fa-solid fa-check-circle text-green-400 text-2xl"></i>
                                <div>
                                    <p className="text-green-400 font-bold">Profile Updated Successfully!</p>
                                    <p className="text-sm text-green-300/80">Your changes have been saved.</p>
                                </div>
                            </div>
                        )}

                        {/* Current Profile Preview */}
                        <div className="mb-8 p-6 rounded-xl bg-white/5 border border-white/10 flex items-center gap-4">
                            <div className="w-20 h-20 rounded-full bg-gradient-to-br from-cyber-blue to-cyber-purple flex items-center justify-center text-5xl border-2 border-cyber-blue/50 shadow-[0_0_20px_rgba(0,240,255,0.3)]">
                                {selectedEmoji}
                            </div>
                            <div className="flex-1">
                                <p className="text-xs text-slate-400 font-mono mb-1">CURRENT PROFILE</p>
                                <p className="text-xl font-bold text-white">{displayName || 'No name set'}</p>
                                <p className="text-sm text-slate-400">{user.email}</p>
                            </div>
                        </div>

                        {/* Display Name Input */}
                        <div className="mb-8">
                            <label className="block text-sm font-bold text-white mb-3 flex items-center gap-2">
                                <i className="fa-solid fa-signature text-cyber-blue"></i>
                                Display Name
                            </label>
                            <input
                                type="text"
                                value={displayName}
                                onChange={(e) => setDisplayName(e.target.value)}
                                placeholder="Enter your display name"
                                className="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white placeholder-slate-500 focus:outline-none focus:border-cyber-blue focus:ring-2 focus:ring-cyber-blue/20 transition-all"
                                maxLength={30}
                            />
                            <p className="text-xs text-slate-500 mt-2">{displayName.length}/30 characters</p>
                        </div>

                        {/* Profile Emoji Selector */}
                        <div className="mb-8">
                            <label className="block text-sm font-bold text-white mb-3 flex items-center gap-2">
                                <i className="fa-solid fa-icons text-cyber-purple"></i>
                                Profile Picture (3D Emoji)
                            </label>
                            <p className="text-xs text-slate-400 mb-4">Choose an emoji to represent you</p>
                            
                            <div className="emoji-selector glass-panel rounded-xl p-4">
                                {EMOJI_COLLECTION.map((emoji, index) => (
                                    <div
                                        key={index}
                                        className={`emoji-option ${selectedEmoji === emoji ? 'selected' : ''}`}
                                        onClick={() => setSelectedEmoji(emoji)}
                                    >
                                        {emoji}
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Account Info (Read-only) */}
                        <div className="mb-8 p-4 rounded-xl bg-white/5 border border-white/10">
                            <p className="text-xs text-slate-400 mb-2 font-mono">ACCOUNT EMAIL (Cannot be changed)</p>
                            <p className="text-white font-medium flex items-center gap-2">
                                <i className="fa-solid fa-envelope text-cyber-blue"></i>
                                {user.email}
                            </p>
                        </div>

                        {/* Action Buttons */}
                        <div className="flex gap-3">
                            <button
                                onClick={onClose}
                                className="flex-1 px-6 py-3 rounded-xl border border-white/20 text-slate-300 font-bold hover:bg-white/5 transition-all"
                            >
                                Cancel
                            </button>
                            <button
                                onClick={handleSave}
                                disabled={saving || !displayName.trim()}
                                className="flex-1 px-6 py-3 rounded-xl bg-gradient-to-r from-cyber-blue to-blue-600 text-black font-bold hover:shadow-[0_0_30px_rgba(0,240,255,0.5)] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                            >
                                {saving ? (
                                    <>
                                        <i className="fa-solid fa-circle-notch animate-spin"></i>
                                        Saving...
                                    </>
                                ) : (
                                    <>
                                        <i className="fa-solid fa-save"></i>
                                        Save Changes
                                    </>
                                )}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const ProfileDropdown = ({ user, onLogout, onOpenSettings, onOpenSecurity, onOpenNotifications, profileEmoji, hasUnreadNotifications }) => {
            const [isOpen, setIsOpen] = useState(false);

            return (
                <div className="relative">
                    <button 
                        onClick={() => setIsOpen(!isOpen)}
                        className="flex items-center gap-3 px-4 py-2 rounded-xl bg-cyber-blue/10 border border-cyber-blue/30 hover:bg-cyber-blue/20 hover:shadow-[0_0_20px_rgba(0,240,255,0.3)] transition-all group"
                    >
                        <div className="w-8 h-8 rounded-full bg-gradient-to-br from-cyber-blue to-cyber-purple flex items-center justify-center text-2xl border border-cyber-blue/50">
                            {profileEmoji}
                        </div>
                        <div className="text-left hidden sm:block">
                            <p className="text-xs text-slate-400 font-mono">LOGGED IN</p>
                            <p className="text-sm font-bold text-white">{user.displayName || user.email}</p>
                        </div>
                        <i className={`fa-solid fa-chevron-down text-cyber-blue text-xs transition-transform ${isOpen ? 'rotate-180' : ''}`}></i>
                    </button>

                    {isOpen && (
                        <>
                            <div className="fixed inset-0 z-40" onClick={() => setIsOpen(false)}></div>
                            <div className="absolute right-0 mt-2 w-64 glass-panel rounded-xl border border-white/10 shadow-xl z-50 animate-slideUp">
                                <div className="p-4 border-b border-white/10">
                                    <div className="flex items-center gap-3">
                                        <div className="w-12 h-12 rounded-full bg-gradient-to-br from-cyber-blue to-cyber-purple flex items-center justify-center border border-cyber-blue/50 text-3xl">
                                            {profileEmoji}
                                        </div>
                                        <div className="flex-1">
                                            <p className="font-bold text-white">{user.displayName || 'User'}</p>
                                            <p className="text-xs text-slate-400 truncate">{user.email}</p>
                                        </div>
                                    </div>
                                </div>

                                <div className="p-2">
                                    <button 
                                        onClick={() => {
                                            setIsOpen(false);
                                            onOpenSettings();
                                        }}
                                        className="w-full p-3 rounded-lg hover:bg-white/5 transition-all flex items-center gap-3 text-slate-300"
                                    >
                                        <i className="fa-solid fa-user-gear text-cyber-blue"></i>
                                        <span>Account Settings</span>
                                    </button>
                                    <button 
                                        onClick={() => {
                                            setIsOpen(false);
                                            onOpenSecurity();
                                        }}
                                        className="w-full p-3 rounded-lg hover:bg-white/5 transition-all flex items-center gap-3 text-slate-300"
                                    >
                                        <i className="fa-solid fa-shield text-cyber-purple"></i>
                                        <span>Security</span>
                                    </button>
                                    <button 
                                        onClick={() => {
                                            setIsOpen(false);
                                            onOpenNotifications();
                                        }}
                                        className="w-full p-3 rounded-lg hover:bg-white/5 transition-all flex items-center gap-3 text-slate-300 relative"
                                    >
                                        <i className="fa-solid fa-bell text-yellow-400"></i>
                                        <span>Notifications</span>
                                        {hasUnreadNotifications && (
                                            <span className="ml-auto w-2 h-2 bg-red-500 rounded-full"></span>
                                        )}
                                    </button>
                                </div>

                                <div className="p-2 border-t border-white/10">
                                    <button 
                                        onClick={onLogout}
                                        className="w-full p-3 rounded-lg hover:bg-red-500/10 transition-all flex items-center gap-3 text-red-400 font-medium"
                                    >
                                        <i className="fa-solid fa-right-from-bracket"></i>
                                        <span>Logout</span>
                                    </button>
                                </div>
                            </div>
                        </>
                    )}
                </div>
            );
        };

        const LoginPopup = ({ onClose }) => {
            return (
                <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-[9999] flex items-center justify-center p-4 animate-fadeIn" onClick={onClose}>
                    <div className="glass-panel rounded-2xl max-w-md w-full p-8 animate-slideUp" onClick={(e) => e.stopPropagation()}>
                        {/* Header */}
                        <div className="flex items-start justify-between mb-6">
                            <div>
                                <h2 className="text-2xl font-bold text-white mb-2 flex items-center gap-2">
                                    <i className="fa-solid fa-shield-virus text-cyber-blue"></i>
                                    CYBERSHIELD
                                </h2>
                                <p className="text-sm text-slate-400">Access Your Security Dashboard</p>
                            </div>
                            <button 
                                onClick={onClose}
                                className="w-10 h-10 rounded-lg border border-white/20 hover:bg-white/5 transition flex items-center justify-center"
                            >
                                <i className="fa-solid fa-xmark text-xl"></i>
                            </button>
                        </div>

                        {/* Login/Register Options */}
                        <div className="space-y-4">
                            <button 
                                onClick={() => window.location.href = 'login.html'}
                                className="w-full p-4 rounded-xl bg-gradient-to-r from-cyber-blue to-blue-600 text-black font-extrabold hover:brightness-110 hover:shadow-[0_0_30px_rgba(0,240,255,0.5)] transition-all flex items-center justify-center gap-3 uppercase tracking-tight"
                            >
                                <i className="fa-solid fa-right-to-bracket text-xl"></i>
                                Login to Account
                            </button>

                            <div className="relative">
                                <div className="absolute inset-0 flex items-center">
                                    <div className="w-full border-t border-white/10"></div>
                                </div>
                                <div className="relative flex justify-center text-xs uppercase">
                                    <span className="bg-cyber-dark px-3 text-slate-500 font-mono">Or</span>
                                </div>
                            </div>

                            <button 
                                onClick={() => window.location.href = 'register.html'}
                                className="w-full p-4 rounded-xl border-2 border-cyber-blue/30 text-cyber-blue font-bold hover:bg-cyber-blue/10 hover:border-cyber-blue transition-all flex items-center justify-center gap-3 uppercase tracking-tight"
                            >
                                <i className="fa-solid fa-user-plus text-xl"></i>
                                Create New Account
                            </button>
                        </div>

                        {/* Footer Info */}
                        <div className="mt-6 pt-6 border-t border-white/10">
                            <p className="text-xs text-slate-500 text-center">
                                <i className="fa-solid fa-lock text-cyber-blue mr-1"></i>
                                Secure authentication powered by Firebase
                            </p>
                        </div>
                    </div>
                </div>
            );
        };

        const MetricCard = ({ label, value, trend, trendValue, icon, color }) => {
            const colors = {
                blue: 'text-cyber-blue border-cyber-blue/30 bg-cyber-blue/10',
                red: 'text-cyber-red border-cyber-red/30 bg-cyber-red/10',
                purple: 'text-cyber-purple border-cyber-purple/30 bg-cyber-purple/10',
                green: 'text-green-400 border-green-400/30 bg-green-400/10'
            };
            return (
                <div className="glass-panel p-6 rounded-2xl relative overflow-hidden transition-all hover:scale-105 animate-fadeIn">
                    <div className="flex justify-between items-start mb-4">
                        <div>
                            <p className="text-sm font-mono text-slate-400 uppercase tracking-wider">{label}</p>
                            <h3 className="text-3xl font-bold text-white mt-1">{value}</h3>
                        </div>
                        <div className={`w-10 h-10 rounded-lg flex items-center justify-center border ${colors[color]}`}>
                            <i className={`fa-solid ${icon}`}></i>
                        </div>
                    </div>
                    <div className="flex items-center gap-2 text-xs font-medium">
                        <span className={trend === 'up' ? 'text-red-400' : 'text-green-400'}>
                            <i className={`fa-solid fa-arrow-${trend}`}></i> {trendValue}
                        </span>
                        <span className="text-slate-500">from database</span>
                    </div>
                </div>
            );
        };

        const ReportDetailModal = ({ report, onClose }) => {
            if (!report) return null;

            const getSeverityColor = (severity) => {
                switch(severity?.toLowerCase()) {
                    case 'high': return 'bg-red-500/20 text-red-400 border-red-500/50';
                    case 'medium': return 'bg-yellow-500/20 text-yellow-400 border-yellow-500/50';
                    case 'low': return 'bg-green-500/20 text-green-400 border-green-500/50';
                    default: return 'bg-blue-500/20 text-blue-400 border-blue-500/50';
                }
            };

            const getStatusColor = (status) => {
                switch(status) {
                    case 'submitted': return 'bg-green-500/20 text-green-400 border-green-500/50';
                    case 'under_review': return 'bg-blue-500/20 text-blue-400 border-blue-500/50';
                    case 'action_taken': return 'bg-purple-500/20 text-purple-400 border-purple-500/50';
                    case 'closed': return 'bg-cyber-blue/20 text-cyber-blue border-cyber-blue/50';
                    default: return 'bg-slate-500/20 text-slate-400 border-slate-500/50';
                }
            };

            return (
                <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-[9999] flex items-center justify-center p-4 animate-fadeIn" onClick={onClose}>
                    <div className="glass-panel rounded-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto p-8 animate-slideIn" onClick={(e) => e.stopPropagation()}>
                        {/* Header */}
                        <div className="flex items-start justify-between mb-6">
                            <div>
                                <h2 className="text-2xl font-bold text-white mb-2">Threat Report Details</h2>
                                <p className="text-sm font-mono text-slate-400">ID: {report.id}</p>
                            </div>
                            <button 
                                onClick={onClose}
                                className="w-10 h-10 rounded-lg border border-white/20 hover:bg-white/5 transition flex items-center justify-center"
                            >
                                <i className="fa-solid fa-xmark text-xl"></i>
                            </button>
                        </div>

                        {/* Status Badges */}
                        <div className="flex gap-3 mb-6">
                            <span className={`px-4 py-2 rounded-full border text-sm font-mono ${getStatusColor(report.status)}`}>
                                {report.status?.replace('_', ' ').toUpperCase() || 'PENDING'}
                            </span>
                            <span className={`px-4 py-2 rounded-full border text-sm font-mono ${getSeverityColor(report.data?.severity)}`}>
                                {report.data?.severity?.toUpperCase() || 'MEDIUM'} SEVERITY
                            </span>
                        </div>

                        {/* Report Details Grid */}
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div className="p-4 rounded-lg bg-white/5 border border-white/10">
                                <p className="text-xs text-slate-400 mb-1">Incident Type</p>
                                <p className="text-white font-medium">{report.data?.incidentType || 'N/A'}</p>
                            </div>

                            <div className="p-4 rounded-lg bg-white/5 border border-white/10">
                                <p className="text-xs text-slate-400 mb-1">Submitted Date</p>
                                <p className="text-white font-medium">{report.submittedDate || 'N/A'}</p>
                            </div>

                            <div className="p-4 rounded-lg bg-white/5 border border-white/10">
                                <p className="text-xs text-slate-400 mb-1">Affected Assets</p>
                                <p className="text-white font-medium">{report.data?.affectedAssets || 'N/A'}</p>
                            </div>

                            <div className="p-4 rounded-lg bg-white/5 border border-white/10">
                                <p className="text-xs text-slate-400 mb-1">IP Address</p>
                                <p className="text-white font-medium font-mono">{report.data?.ipAddress || 'Not provided'}</p>
                            </div>

                            {report.data?.timestamp && (
                                <div className="p-4 rounded-lg bg-white/5 border border-white/10">
                                    <p className="text-xs text-slate-400 mb-1">Incident Timestamp</p>
                                    <p className="text-white font-medium">{new Date(report.data.timestamp).toLocaleString()}</p>
                                </div>
                            )}

                            {!report.data?.anonymous && (
                                <>
                                    <div className="p-4 rounded-lg bg-white/5 border border-white/10">
                                        <p className="text-xs text-slate-400 mb-1">Reporter</p>
                                        <p className="text-white font-medium">{report.data?.reporter || 'N/A'}</p>
                                    </div>

                                    <div className="p-4 rounded-lg bg-white/5 border border-white/10">
                                        <p className="text-xs text-slate-400 mb-1">Contact Email</p>
                                        <p className="text-white font-medium">{report.data?.email || 'N/A'}</p>
                                    </div>
                                </>
                            )}

                            {report.data?.anonymous && (
                                <div className="p-4 rounded-lg bg-white/5 border border-white/10 md:col-span-2">
                                    <p className="text-xs text-slate-400 mb-1">Reporter Information</p>
                                    <p className="text-yellow-400 font-medium flex items-center gap-2">
                                        <i className="fa-solid fa-eye-slash"></i>
                                        Anonymous Submission
                                    </p>
                                </div>
                            )}
                        </div>

                        {/* Description */}
                        {report.data?.description && (
                            <div className="mb-6">
                                <h3 className="text-sm text-slate-400 mb-2 uppercase tracking-wider">Incident Description</h3>
                                <div className="p-4 rounded-lg bg-white/5 border border-white/10">
                                    <p className="text-white leading-relaxed">{report.data.description}</p>
                                </div>
                            </div>
                        )}

                        {/* Evidence Files */}
                        {report.files && report.files.length > 0 && (
                            <div className="mb-6">
                                <h3 className="text-sm text-slate-400 mb-2 uppercase tracking-wider">Evidence Files ({report.files.length})</h3>
                                <div className="space-y-2">
                                    {report.files.map((file, index) => (
                                        <div key={index} className="p-3 rounded-lg bg-white/5 border border-white/10 flex items-center gap-3">
                                            <i className="fa-solid fa-file text-cyber-blue text-xl"></i>
                                            <div className="flex-1">
                                                <p className="text-white text-sm font-medium">{file.name}</p>
                                                <p className="text-xs text-slate-400">{file.size}</p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Additional Options */}
                        <div className="flex gap-3 pt-4 border-t border-white/10">
                            {report.data?.containment && (
                                <div className="flex-1 p-3 rounded-lg bg-red-500/10 border border-red-500/30 flex items-center gap-2">
                                    <i className="fa-solid fa-shield-halved text-red-400"></i>
                                    <span className="text-sm text-red-400 font-medium">Immediate Containment Requested</span>
                                </div>
                            )}
                        </div>

                        <div className="mt-6 flex justify-end">
                            <button 
                                onClick={onClose}
                                className="px-6 py-3 bg-gradient-to-r from-cyber-blue to-blue-600 rounded-xl font-bold text-black hover:shadow-[0_0_30px_rgba(0,240,255,0.5)] transition-all"
                            >
                                Close Details
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const Dashboard = () => {
            const [reports, setReports] = useState([]);
            const [loading, setLoading] = useState(true);
            const [selectedReport, setSelectedReport] = useState(null);
            const [showLoginPopup, setShowLoginPopup] = useState(false);
            const [showSettingsModal, setShowSettingsModal] = useState(false);
            const [showSecurityModal, setShowSecurityModal] = useState(false);
            const [showNotificationsModal, setShowNotificationsModal] = useState(false);
            const [currentUser, setCurrentUser] = useState(null);
            const [authLoading, setAuthLoading] = useState(true);
            const [profileEmoji, setProfileEmoji] = useState('ðŸš€');
            const [mobileOpen, setMobileOpen] = useState(false);
            const [notifications, setNotifications] = useState(SAMPLE_NOTIFICATIONS);
            const [stats, setStats] = useState({
                total: 0,
                high: 0,
                medium: 0,
                low: 0,
                submitted: 0,
                underReview: 0,
                closed: 0
            });

            const hasUnreadNotifications = notifications.some(n => !n.read);

            // Check authentication state
            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged(async (user) => {
                    setCurrentUser(user);
                    
                    if (user) {
                        // Load emoji from localStorage or database
                        const savedEmoji = localStorage.getItem(`userEmoji_${user.uid}`);
                        if (savedEmoji) {
                            setProfileEmoji(savedEmoji);
                        } else {
                            // Try to load from database
                            try {
                                const snapshot = await database.ref(`users/${user.uid}/profile/emoji`).once('value');
                                const dbEmoji = snapshot.val();
                                if (dbEmoji) {
                                    setProfileEmoji(dbEmoji);
                                    localStorage.setItem(`userEmoji_${user.uid}`, dbEmoji);
                                }
                            } catch (error) {
                                console.error('Error loading emoji:', error);
                            }
                        }

                        // Load notifications from localStorage
                        const savedNotifications = localStorage.getItem(`notifications_${user.uid}`);
                        if (savedNotifications) {
                            setNotifications(JSON.parse(savedNotifications));
                        }
                    }
                    
                    setAuthLoading(false);
                });

                return () => unsubscribe();
            }, []);

            useEffect(() => {
                // Reference to the 'reports' node in your database
                const reportsRef = database.ref('reports');
                
                // Real-time listener
                const handleData = (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        const formattedList = Object.keys(data).map(key => ({
                            firebaseKey: key,
                            ...data[key]
                        }));
                        
                        // Sort by timestamp (newest first)
                        formattedList.sort((a, b) => {
                            const dateA = new Date(a.submittedTimestamp || 0);
                            const dateB = new Date(b.submittedTimestamp || 0);
                            return dateB - dateA;
                        });

                        setReports(formattedList);

                        // Calculate statistics
                        const newStats = {
                            total: formattedList.length,
                            high: formattedList.filter(r => r.data?.severity === 'high').length,
                            medium: formattedList.filter(r => r.data?.severity === 'medium').length,
                            low: formattedList.filter(r => r.data?.severity === 'low').length,
                            submitted: formattedList.filter(r => r.status === 'submitted').length,
                            underReview: formattedList.filter(r => r.status === 'under_review').length,
                            closed: formattedList.filter(r => r.status === 'closed').length
                        };
                        setStats(newStats);
                    } else {
                        setReports([]);
                        setStats({
                            total: 0,
                            high: 0,
                            medium: 0,
                            low: 0,
                            submitted: 0,
                            underReview: 0,
                            closed: 0
                        });
                    }
                    setLoading(false);
                };

                reportsRef.on('value', handleData);

                // Cleanup listener on unmount
                return () => reportsRef.off('value', handleData);
            }, []);

            const handleLogout = async () => {
                try {
                    await auth.signOut();
                    window.location.href = 'login.html';
                } catch (error) {
                    console.error('Logout error:', error);
                }
            };

            const handleProfileUpdate = () => {
                // Reload user data
                auth.currentUser.reload().then(() => {
                    setCurrentUser(auth.currentUser);
                    // Reload emoji
                    const savedEmoji = localStorage.getItem(`userEmoji_${auth.currentUser.uid}`);
                    if (savedEmoji) {
                        setProfileEmoji(savedEmoji);
                    }
                });
            };

            const handleMarkAsRead = (notifId) => {
                const updated = notifications.map(n => 
                    n.id === notifId ? { ...n, read: true } : n
                );
                setNotifications(updated);
                if (currentUser) {
                    localStorage.setItem(`notifications_${currentUser.uid}`, JSON.stringify(updated));
                }
            };

            const handleMarkAllAsRead = () => {
                const updated = notifications.map(n => ({ ...n, read: true }));
                setNotifications(updated);
                if (currentUser) {
                    localStorage.setItem(`notifications_${currentUser.uid}`, JSON.stringify(updated));
                }
            };

            const getSeverityBadge = (severity) => {
                switch(severity?.toLowerCase()) {
                    case 'high':
                        return 'bg-red-500/10 text-red-400 border-red-500/20';
                    case 'medium':
                        return 'bg-yellow-500/10 text-yellow-400 border-yellow-500/20';
                    case 'low':
                        return 'bg-green-500/10 text-green-400 border-green-500/20';
                    default:
                        return 'bg-blue-500/10 text-blue-400 border-blue-500/20';
                }
            };

            const getStatusBadge = (status) => {
                switch(status) {
                    case 'submitted':
                        return 'bg-green-500/10 text-green-400 border-green-500/20';
                    case 'under_review':
                        return 'bg-blue-500/10 text-blue-400 border-blue-500/20';
                    case 'action_taken':
                        return 'bg-purple-500/10 text-purple-400 border-purple-500/20';
                    case 'closed':
                        return 'bg-cyber-blue/10 text-cyber-blue border-cyber-blue/20';
                    default:
                        return 'bg-slate-500/10 text-slate-400 border-slate-500/20';
                }
            };

            const getIncidentTypeIcon = (type) => {
                switch(type) {
                    case 'phishing': return 'fa-fish';
                    case 'malware': return 'fa-virus';
                    case 'ddos': return 'fa-server';
                    case 'breach': return 'fa-user-secret';
                    case 'unauthorized': return 'fa-lock-open';
                    case 'suspicious': return 'fa-magnifying-glass';
                    default: return 'fa-triangle-exclamation';
                }
            };

            if (authLoading) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="text-center">
                            <i className="fa-solid fa-circle-notch animate-spin text-5xl text-cyber-blue mb-4"></i>
                            <p className="text-slate-400 font-mono">Authenticating...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen pl-0 lg:pl-64 transition-all duration-300">
                    {/* Sidebar */}
                    <aside className="w-20 lg:w-64 h-screen fixed left-0 top-0 glass-panel border-r border-white/10 flex flex-col z-50">
                        <div className="p-6 flex items-center gap-3 justify-center lg:justify-start">
                            <i className="fa-solid fa-shield-virus text-3xl text-cyber-blue animate-pulse-fast"></i>
                            <span className="hidden lg:block text-xl font-bold tracking-wider text-white">
                                CYBER<span className="text-cyber-blue">SHIELD</span>
                            </span>
                        </div>
                        <nav className="flex-1 py-8 flex flex-col gap-2">
                            <button className="flex items-center gap-4 px-6 py-4 text-cyber-blue bg-white/5 relative">
                                <div className="absolute left-0 top-0 bottom-0 w-1 bg-cyber-blue shadow-[0_0_15px_rgba(0,240,255,0.8)]"></div>
                                <i className="fa-solid fa-chart-pie text-xl w-6 text-center"></i>
                                <span className="hidden lg:block font-medium">Overview</span>
                            </button>
                            <button onClick={() => window.location.href='report-page.html'} className="flex items-center gap-4 px-6 py-4 text-slate-400 hover:text-white hover:bg-white/5 transition-all">
                                <i className="fa-solid fa-file-shield text-xl w-6 text-center"></i>
                                <span className="hidden lg:block font-medium">Report Threat</span>
                            </button>
                            <button onClick={() => window.location.href='admin-panel.html'} className="flex items-center gap-4 px-6 py-4 text-slate-400 hover:text-white hover:bg-white/5 transition-all">
                                <i className="fa-solid fa-user-shield text-xl w-6 text-center"></i>
                                <span className="hidden lg:block font-medium">Admin Panel</span>
                            </button>
                        </nav>
                    </aside>

                    {/* Header */}
                    <header className="h-20 border-b border-white/10 glass-panel sticky top-0 z-40 px-4 lg:px-8 flex items-center justify-between">
                        <div className="flex items-center gap-4">
                            <button
                                onClick={() => setMobileOpen(true)}
                                className="lg:hidden p-2 rounded-md bg-black/20 hover:bg-white/5 transition"
                                aria-label="Open menu"
                            >
                                <i className="fa-solid fa-bars text-cyber-blue"></i>
                            </button>

                            <div>
                                <p className="text-xs text-slate-400 font-mono">NODE: ASIA-SE1</p>
                                <h2 className="text-lg lg:text-xl font-bold text-white tracking-wide">REAL-TIME MONITOR</h2>
                            </div>
                        </div>
                        <div className="flex items-center gap-4">
                            <div className="text-right hidden sm:block">
                                <p className="text-xs text-slate-400 font-mono">DATABASE</p>
                                <div className="flex items-center gap-2">
                                    <span className="w-2 h-2 bg-green-400 rounded-full animate-pulse"></span>
                                    <p className="text-xs text-green-400 font-bold">CONNECTED</p>
                                </div>
                            </div>
                            
                            {currentUser ? (
                                <>
                                    <div className="hidden sm:flex items-center gap-3">
                                        <button onClick={() => setShowSettingsModal(true)} className="p-2 rounded-lg bg-black/30 hover:bg-white/5 transition flex items-center justify-center" title="Account Settings">
                                            <i className="fa-solid fa-user-gear text-cyber-blue"></i>
                                        </button>
                                        <button onClick={() => setShowSecurityModal(true)} className="p-2 rounded-lg bg-black/30 hover:bg-white/5 transition flex items-center justify-center" title="Security">
                                            <i className="fa-solid fa-shield text-cyber-purple"></i>
                                        </button>
                                        <button onClick={() => setShowNotificationsModal(true)} className="relative p-2 rounded-lg bg-black/30 hover:bg-white/5 transition flex items-center justify-center" title="Notifications">
                                            <i className="fa-solid fa-bell text-yellow-400"></i>
                                            <span className="absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full" style={{ transform: 'translate(45%, -45%)' }}></span>
                                        </button>
                                    </div>

                                    <ProfileDropdown 
                                        user={currentUser} 
                                        onLogout={handleLogout}
                                        onOpenSettings={() => setShowSettingsModal(true)}
                                        onOpenSecurity={() => setShowSecurityModal(true)}
                                        onOpenNotifications={() => setShowNotificationsModal(true)}
                                        profileEmoji={profileEmoji}
                                        hasUnreadNotifications={hasUnreadNotifications}
                                    />
                                </>
                            ) : (
                                <button 
                                    onClick={() => setShowLoginPopup(true)}
                                    className="px-4 py-2 rounded-xl bg-gradient-to-r from-cyber-blue to-blue-600 text-black font-bold hover:shadow-[0_0_20px_rgba(0,240,255,0.3)] transition-all flex items-center gap-2"
                                >
                                    <i className="fa-solid fa-right-to-bracket"></i>
                                    <span className="hidden sm:inline">Login</span>
                                </button>
                            )}
                        </div>
                    </header>

                    {mobileOpen && (
                        <>
                            <div className="fixed inset-0 z-40 bg-black/50 lg:hidden" onClick={() => setMobileOpen(false)}></div>
                            <aside className="fixed left-0 top-0 bottom-0 w-72 z-50 glass-panel p-6 lg:hidden overflow-y-auto">
                                <div className="flex items-center justify-between mb-6">
                                    <div className="flex items-center gap-3">
                                        <i className="fa-solid fa-shield-virus text-2xl text-cyber-blue"></i>
                                        <span className="font-bold text-white">CYBERSHIELD</span>
                                    </div>
                                    <button onClick={() => setMobileOpen(false)} className="p-2 rounded-md hover:bg-white/5">
                                        <i className="fa-solid fa-xmark text-white"></i>
                                    </button>
                                </div>

                                <nav className="flex flex-col gap-2">
                                    <a href="dashboard.html" className="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-white/5 text-slate-200">
                                        <i className="fa-solid fa-chart-pie w-6 text-cyber-blue"></i>
                                        <span>Overview</span>
                                    </a>
                                    <a href="report-page.html" className="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-white/5 text-slate-200">
                                        <i className="fa-solid fa-file-shield w-6 text-cyber-blue"></i>
                                        <span>Report Threat</span>
                                    </a>
                                    <a href="admin-panel.html" className="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-white/5 text-slate-200">
                                        <i className="fa-solid fa-user-shield w-6 text-cyber-blue"></i>
                                        <span>Admin Panel</span>
                                    </a>
                                </nav>

                                <div className="mt-6 border-t border-white/10 pt-4">
                                    <button onClick={() => { setShowSettingsModal(true); setMobileOpen(false); }} className="w-full text-left px-4 py-3 rounded-lg hover:bg-white/5 flex items-center gap-3">
                                        <i className="fa-solid fa-user-gear text-cyber-blue"></i>
                                        <span>Account Settings</span>
                                    </button>
                                    <button onClick={() => { setShowSecurityModal(true); setMobileOpen(false); }} className="w-full text-left px-4 py-3 rounded-lg hover:bg-white/5 flex items-center gap-3 mt-2">
                                        <i className="fa-solid fa-shield text-cyber-purple"></i>
                                        <span>Security</span>
                                    </button>
                                    <button onClick={() => { setShowNotificationsModal(true); setMobileOpen(false); }} className="w-full text-left px-4 py-3 rounded-lg hover:bg-white/5 flex items-center gap-3 mt-2">
                                        <i className="fa-solid fa-bell text-yellow-400"></i>
                                        <span>Notifications</span>
                                    </button>
                                </div>
                            </aside>
                        </>
                    )}

                    {/* Main Content */}
                    <main className="p-6 lg:p-8 max-w-7xl mx-auto space-y-6">
                        
                        {/* Stats Row */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                            <MetricCard 
                                label="Total Reports" 
                                value={stats.total} 
                                trend="up" 
                                trendValue={`${stats.total} total`} 
                                icon="fa-file-shield" 
                                color="blue" 
                            />
                            <MetricCard 
                                label="High Severity" 
                                value={stats.high} 
                                trend={stats.high > 0 ? "up" : "down"} 
                                trendValue={`${stats.high} critical`} 
                                icon="fa-triangle-exclamation" 
                                color="red" 
                            />
                            <MetricCard 
                                label="Under Review" 
                                value={stats.underReview} 
                                trend={stats.underReview > 0 ? "up" : "down"} 
                                trendValue={`${stats.underReview} active`} 
                                icon="fa-magnifying-glass" 
                                color="purple" 
                            />
                            <MetricCard 
                                label="Resolved" 
                                value={stats.closed} 
                                trend="down" 
                                trendValue={`${stats.closed} closed`} 
                                icon="fa-check-circle" 
                                color="green" 
                            />
                        </div>

                        {/* Feed Row */}
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <div className="lg:col-span-2 glass-panel rounded-2xl p-6 h-[600px] flex flex-col animate-fadeIn">
                                <div className="flex items-center justify-between mb-6">
                                    <h3 className="text-lg font-bold text-white flex items-center gap-2">
                                        <span className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                                        Live Threat Reports Feed
                                    </h3>
                                    <div className="flex items-center gap-3">
                                        <span className="text-xs font-mono text-slate-400 bg-white/5 px-3 py-1 rounded-full border border-white/10">
                                            {reports.length} REPORTS
                                        </span>
                                        <button 
                                            onClick={() => window.location.reload()} 
                                            className="text-xs text-slate-500 hover:text-cyber-blue transition-colors flex items-center gap-2"
                                        >
                                            <i className="fa-solid fa-rotate"></i>
                                            REFRESH
                                        </button>
                                    </div>
                                </div>

                                <div className="space-y-3 overflow-y-auto pr-2 flex-1">
                                    {loading ? (
                                        <div className="h-full flex flex-col items-center justify-center text-slate-500 font-mono space-y-4">
                                            <i className="fa-solid fa-circle-notch animate-spin text-3xl text-cyber-blue"></i>
                                            <p>SYNCHRONIZING WITH DATABASE...</p>
                                        </div>
                                    ) : reports.length === 0 ? (
                                        <div className="h-full flex flex-col items-center justify-center text-slate-500">
                                            <i className="fa-solid fa-inbox text-5xl mb-4 opacity-20"></i>
                                            <p className="font-bold text-lg mb-2">No Reports Found</p>
                                            <p className="text-sm">User-submitted threat reports will appear here</p>
                                        </div>
                                    ) : (
                                        reports.map((report, index) => (
                                            <div 
                                                key={report.firebaseKey || index} 
                                                className="p-4 rounded-xl bg-white/5 border border-white/5 hover:border-cyber-blue/30 transition-all group cursor-pointer animate-slideIn"
                                                onClick={() => setSelectedReport(report)}
                                                style={{ animationDelay: `${index * 0.05}s` }}
                                            >
                                                <div className="flex justify-between items-start mb-3">
                                                    <div className="flex gap-2">
                                                        <span className={`text-[10px] font-bold px-2 py-1 rounded border ${getSeverityBadge(report.data?.severity)}`}>
                                                            {report.data?.severity?.toUpperCase() || 'MEDIUM'}
                                                        </span>
                                                        <span className={`text-[10px] font-bold px-2 py-1 rounded border ${getStatusBadge(report.status)}`}>
                                                            {report.status?.replace('_', ' ').toUpperCase() || 'PENDING'}
                                                        </span>
                                                    </div>
                                                    <span className="text-[10px] font-mono text-slate-500">{report.submittedDate || 'Just now'}</span>
                                                </div>

                                                <div className="flex items-center gap-3 mb-2">
                                                    <div className="w-8 h-8 rounded-lg bg-cyber-blue/10 border border-cyber-blue/30 flex items-center justify-center">
                                                        <i className={`fa-solid ${getIncidentTypeIcon(report.data?.incidentType)} text-cyber-blue text-sm`}></i>
                                                    </div>
                                                    <div className="flex-1">
                                                        <h4 className="font-bold text-slate-200 group-hover:text-cyber-blue transition-colors">
                                                            {report.data?.incidentType?.charAt(0).toUpperCase() + report.data?.incidentType?.slice(1) || 'Unknown Incident'}
                                                        </h4>
                                                        <p className="text-xs text-slate-500 font-mono">ID: {report.id}</p>
                                                    </div>
                                                </div>

                                                <div className="grid grid-cols-2 gap-2 text-xs mt-3 pt-3 border-t border-white/5">
                                                    <div>
                                                        <span className="text-slate-500">Target:</span>
                                                        <span className="text-cyber-blue/80 font-mono ml-1">{report.data?.affectedAssets || 'N/A'}</span>
                                                    </div>
                                                    {report.files && report.files.length > 0 && (
                                                        <div className="text-right">
                                                            <i className="fa-solid fa-paperclip text-slate-500 mr-1"></i>
                                                            <span className="text-slate-400">{report.files.length} file(s)</span>
                                                        </div>
                                                    )}
                                                </div>

                                                {report.data?.description && (
                                                    <p className="text-xs text-slate-400 mt-2 line-clamp-2">{report.data.description}</p>
                                                )}

                                                <div className="flex items-center justify-between mt-3 pt-3 border-t border-white/5">
                                                    {report.data?.anonymous ? (
                                                        <span className="text-xs text-yellow-400 flex items-center gap-1">
                                                            <i className="fa-solid fa-eye-slash"></i>
                                                            Anonymous
                                                        </span>
                                                    ) : (
                                                        <span className="text-xs text-slate-500">
                                                            By: <span className="text-slate-300">{report.data?.reporter || 'Unknown'}</span>
                                                        </span>
                                                    )}
                                                    
                                                    <button className="text-xs text-cyber-blue hover:underline flex items-center gap-1">
                                                        View Details
                                                        <i className="fa-solid fa-arrow-right"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>

                            {/* Sidebar Panel */}
                            <div className="space-y-6">
                                {/* Quick Actions */}
                                <div className="glass-panel rounded-2xl p-6 animate-fadeIn" style={{ animationDelay: '0.2s' }}>
                                    <h3 className="text-lg font-bold text-white mb-6 font-mono flex items-center gap-2">
                                        <i className="fa-solid fa-bolt text-cyber-blue"></i>
                                        QUICK_ACTIONS
                                    </h3>
                                    <div className="space-y-3">
                                        <button 
                                            onClick={() => window.location.href = 'report-page.html'}
                                            className="w-full p-4 rounded-xl bg-gradient-to-r from-cyber-blue to-blue-600 text-black font-extrabold hover:brightness-110 hover:shadow-[0_0_20px_rgba(0,240,255,0.3)] transition-all flex items-center justify-center gap-2 uppercase tracking-tight"
                                        >
                                            <i className="fa-solid fa-plus-circle"></i>
                                            New Report
                                        </button>
                                        
                                        <button 
                                            onClick={() => window.location.href = 'admin-panel.html'}
                                            className="w-full p-3 rounded-xl border border-white/20 text-slate-300 font-bold hover:bg-white/5 transition-all flex items-center justify-center gap-2"
                                        >
                                            <i className="fa-solid fa-shield-halved"></i>
                                            Admin Panel
                                        </button>
                                    </div>
                                </div>

                                {/* Statistics */}
                                <div className="glass-panel rounded-2xl p-6 animate-fadeIn" style={{ animationDelay: '0.3s' }}>
                                    <h3 className="text-lg font-bold text-white mb-4 font-mono">SEVERITY_STATS</h3>
                                    <div className="space-y-3">
                                        <div className="flex items-center justify-between p-3 rounded-lg bg-red-500/10 border border-red-500/20">
                                            <span className="text-sm text-red-400 font-medium">High</span>
                                            <span className="text-xl font-bold text-red-400">{stats.high}</span>
                                        </div>
                                        <div className="flex items-center justify-between p-3 rounded-lg bg-yellow-500/10 border border-yellow-500/20">
                                            <span className="text-sm text-yellow-400 font-medium">Medium</span>
                                            <span className="text-xl font-bold text-yellow-400">{stats.medium}</span>
                                        </div>
                                        <div className="flex items-center justify-between p-3 rounded-lg bg-green-500/10 border border-green-500/20">
                                            <span className="text-sm text-green-400 font-medium">Low</span>
                                            <span className="text-xl font-bold text-green-400">{stats.low}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </main>

                    {/* Report Detail Modal */}
                    {selectedReport && (
                        <ReportDetailModal 
                            report={selectedReport} 
                            onClose={() => setSelectedReport(null)} 
                        />
                    )}

                    {/* Login Popup */}
                    {showLoginPopup && (
                        <LoginPopup onClose={() => setShowLoginPopup(false)} />
                    )}

                    {/* Account Settings Modal */}
                    {showSettingsModal && currentUser && (
                        <AccountSettingsModal
                            user={currentUser}
                            onClose={() => setShowSettingsModal(false)}
                            onUpdate={handleProfileUpdate}
                        />
                    )}

                    {/* Security Modal */}
                    {showSecurityModal && (
                        <SecurityModal onClose={() => setShowSecurityModal(false)} />
                    )}

                    {/* Notifications Modal */}
                    {showNotificationsModal && (
                        <NotificationsModal 
                            onClose={() => setShowNotificationsModal(false)}
                            notifications={notifications}
                            onMarkAsRead={handleMarkAsRead}
                            onMarkAllAsRead={handleMarkAllAsRead}
                        />
                    )}
                </div>
            );
        };

        ReactDOM.render(<Dashboard />, document.getElementById('root'));
    </script>
</body>
</html>